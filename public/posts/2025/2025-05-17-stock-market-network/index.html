<!doctype html><html lang=vi dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Community detection for VN100 | The Financial Engineer</title>
<meta name=keywords content><meta name=description content="Thử nghiệm xây dựng chiến lược dựa trên thuật toán community detection"><meta name=author content><link rel=canonical href=http://localhost:1313/posts/2025/2025-05-17-stock-market-network/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=vi href=http://localhost:1313/posts/2025/2025-05-17-stock-market-network/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous referrerpolicy=no-referrer><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous referrerpolicy=no-referrer type=text/javascript></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous referrerpolicy=no-referrer type=text/javascript></script><script type=text/javascript>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-BEV31LZP2J"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BEV31LZP2J")}</script><meta property="og:title" content="Community detection for VN100"><meta property="og:description" content="Thử nghiệm xây dựng chiến lược dựa trên thuật toán community detection"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/2025/2025-05-17-stock-market-network/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-05-19T00:00:00+00:00"><meta property="article:modified_time" content="2025-05-19T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Community detection for VN100"><meta name=twitter:description content="Thử nghiệm xây dựng chiến lược dựa trên thuật toán community detection"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Community detection for VN100","item":"http://localhost:1313/posts/2025/2025-05-17-stock-market-network/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Community detection for VN100","name":"Community detection for VN100","description":"Thử nghiệm xây dựng chiến lược dựa trên thuật toán community detection","keywords":[],"articleBody":" Bài viết này thử nghiệm bài toán “Community detection” cho thị trường chứng khoán Việt Nam (VN100) và backtest 1 chiến lược dựa trên thuật toán này.\nBài viết được lấy ý tưởng từ: https://arxiv.org/pdf/2112.13383\nĐể lấy file code và dữ liệu, vui lòng gửi email tới hung.ha@miquant.vn\nConcept Trong một môi trường có nhiều yếu tố tương tác với nhau, sự tương quan (thể hiện qua xu hướng biến động giống nhau) là điều tất yếu, và thị trường chứng khoán cũng không ngoại lệ. Mặc dù mối tương quan giữa các cổ phiếu đã được biết đến từ lâu, nhưng phải đến khi Harry Markowitz giới thiệu Lý thuyết Danh mục Đầu tư Hiện đại vào năm 1952, nó mới được áp dụng rộng rãi. Lý thuyết này đề xuất phương pháp định lượng để tối ưu hóa danh mục đầu tư dựa trên mối tương quan giữa các tài sản. Kể từ đó, việc nghiên cứu mối liên hệ giữa các cổ phiếu đã phát triển theo nhiều hướng, trong đó việc áp dụng lý thuyết mạng (Network Theory) nổi lên như một phương pháp hiệu quả và đang được đặc biệt quan tâm trong giai đoạn đầy biến động này.\nStarting simple, correlation matrix Correlation: what is it? Tương quan (correlation) là một chỉ số thống kê đo lường mức độ biến động đồng thời giữa hai biến số. Trong thị trường chứng khoán, tương quan thường được sử dụng để đánh giá mối liên hệ giữa giá của các cổ phiếu.\nCông thức tính hệ số tương quan Pearson:\n$$ r = \\frac{\\sum_{i=1}^{n} (x_i - \\bar{x})(y_i - \\bar{y})}{\\sqrt{\\sum_{i=1}^{n} (x_i - \\bar{x})^2}\\sqrt{\\sum_{i=1}^{n} (y_i - \\bar{y})^2}} $$Nói một cách đơn giản, tương quan giữa các cổ phiếu thể hiện mức độ “đồng hành” của chúng. Khi hai cổ phiếu có tương quan cao (gần 1), chúng thường tăng giảm cùng nhau—ví dụ, khi một cổ phiếu tăng 5%, cổ phiếu kia cũng có xu hướng tăng tương tự. Ngược lại, tương quan âm (gần -1) nghĩa là khi cổ phiếu này tăng, cổ phiếu kia thường giảm. Tương quan bằng 0 không đồng nghĩa với việc hai cổ phiếu không liên quan đến nhau, mà chỉ cho thấy không có mối liên hệ tuyến tính rõ ràng trong biến động giá của chúng.\nBài viết minh họa điều này qua việc so sánh tương quan giữa HPG với HSG và BWE. Với hệ số tương quan 0,8 (tính trên hiệu suất tuần), HPG và HSG có mối tương quan mạnh. Điều này dễ hiểu bởi cả hai đều là doanh nghiệp sản xuất thép, chịu tác động từ cùng các yếu tố thị trường như giá nguyên liệu đầu vào và nhu cầu xây dựng. Ngược lại, HPG và BWE chỉ có hệ số tương quan 0,2, cho thấy sự khác biệt trong mô hình kinh doanh và các yếu tố ảnh hưởng đến giá cổ phiếu của hai doanh nghiệp.\nQua đó có thể thấy, các cổ phiếu cùng ngành (hay rộng hơn là có chung các yếu tố cơ bản) thường phản ánh xu hướng biến động giá và rủi ro tương tự nhau, do nhà đầu tư thường định giá và quyết định dựa trên những yếu tố tương đồng. Hiện tượng này tạo ra hiệu ứng “cộng hưởng” trong biến động giá, khiến các cổ phiếu cùng nhóm ngành thường di chuyển đồng thời với nhau. Đây chính là nguồn gốc của rủi ro hệ thống (systematic risk).\nKhi mở rộng phân tích từ một vài cổ phiếu lên hàng chục, thậm chí hàng trăm mã (ví dụ như VN100), phương pháp chỉ dựa vào ma trận tương quan thuần túy sẽ gặp phải nhiều hạn chế sau:\nCurse of dimensionality Với $N$ tài sản, ta phải tính tới $\\tfrac{N(N-1)}{2}$ cặp tương quan. Khi $\\tfrac{N(N-1)}{2}$, con số này lên tới 4.950 cặp — vượt ra ngoài khả năng trực quan hóa và so sánh thủ công, dẫn đến “quá tải thông tin”. Noise và sai số ước lượng lớn Dữ liệu giá luôn chứa nhiều nhiễu và có tính không ổn định theo thời gian. Khi số tài sản tăng, sai số ước lượng hệ số tương quan (nhất là với mẫu nhỏ) càng lớn, dễ sinh ra các giá trị tương quan “giả” (spurious), từ đó gây hiểu nhầm về mối quan hệ giữa các cổ phiếu. Khó trích xuất cấu trúc Ma trận tương quan thuần túy thường rất “đậm đặc” (dense) — hầu như mọi cặp đều có tương quan khác 0. Điều này khiến khó khăn trong việc phân nhóm (clustering) hay tìm kiếm các cấu trúc ẩn (hidden pattern), vì không có điểm nhấn rõ nét để tách biệt các khối tài sản liên quan chặt chẽ. From correlation to network and community Con người vốn quen mô tả thế giới qua các thực thể (node) và mối quan hệ (edge): trong mạng xã hội, mỗi người là một nút, các liên hệ “kết bạn”, “theo dõi” tạo thành cạnh, và nhờ đó ta dễ dàng nhận ra gia đình, nhóm bạn, hay những nhân vật trung tâm chỉ bằng cách quan sát cấu trúc kết nối.\nTư duy trực quan này được áp dụng cho thị trường chứng khoán: thay vì xem xét từng cặp hệ số tương quan riêng lẻ, ta biến mỗi cổ phiếu thành một nút (node) và dùng đường nối (edge) thể hiện mức độ liên hệ về giá. Kết quả là một “bản đồ” mạng lưới, nơi các nhóm cổ phiếu cùng ngành hay cùng chu kỳ kinh doanh tự động hiện ra như những cộng đồng trong mạng xã hội. Điều này giúp nhà đầu tư nhanh chóng nắm bắt được các mối liên hệ, xác định được những cổ phiếu đóng vai trò “cầu nối” và nhận diện được các tâm điểm rủi ro – cơ hội mà không cần đi sâu vào khối dữ liệu đồ sộ của ma trận tương quan.\nTheory \u0026 Mathematical model Để biến đổi từ correlation matrix thành 1 network, bước 1 ta cần biến đổi từ cấu trúc matrix thành cấu trúc network. Sau đó, từ network tạo ra, ta tiến hành gom nhóm các cổ phiếu giống nhau lại.\nĐể xây dựng 1 network, 2 thuật toán nổi tiếng là Planar Maximally Filtered Graph và Minimum Spanning Tree.\nPlanar Maximally Filtered Graph (PMFG) PMFG giữ lại các liên kết quan trọng nhất trong khi buộc đồ thị phải duy trì tính phẳng (planar) (có thể vẽ trên một tờ giấy mà không có cạnh nào cắt nhau). Vì một đồ thị phẳng chỉ có thể có tối đa $E_{\\text{PMFG}} = 3(N-2)$ cạnh, bộ lọc thu gọn mạng lưới một cách đáng kể (nhưng vẫn bảo toàn được gấp ba lần thông tin so với Minimum Spanning Tree, vốn chỉ có $N-1$ cạnh) (đọc kĩ hơn tại đây: https://gmarti.gitlab.io/networks/2018/06/03/pmfg-algorithm.html).\nKết quả thu được sẽ giữ lại cấu trúc cốt lõi của các mối quan hệ mạnh nhất :). In a simple way, thay vì giữ toàn bộ N*(N-1)/2 thì giờ chỉ còn tối đa 3(N-2) cạnh (mối quan hệ), tương đương với 3*(100-2) = 294 cạnh so với 4950 (giảm 16 lần)\nInput của PMFG hay MST trong trường hợp này đều là correlation matrix.\nCommunity detection Sau khi đã có mạng PMFG tinh gọn, bước tiếp theo là chia mạng thành những “cụm” (community) cổ phiếu giống nhau. Hai cách phổ biến nhất là Louvain (tối ưu modularity) và Infomap (tối ưu dòng ngẫu nhiên).\nLouvain Louvain chia mạng thành cộng đồng bằng cách tối đa hóa chỉ số modularity Q – thước đo so sánh mật độ liên kết trong cộng đồng với mật độ mong đợi nếu các cạnh được nối ngẫu nhiên.\n$$ Q = \\frac{1}{2m}\\sum_{i,j}\\Bigl(A_{ij} - \\frac{k_i k_j}{2m}\\Bigr)\\delta(c_i,c_j), $$trong đó:\nAij = trọng số của cạnh giữa i và j, ki = tổng trọng số gắn với nút i, m = tổng trọng số cạnh, δ(ci,cj) = 1 nếu các nút cùng cộng đồng. Thuật toán Louvain hoạt động lặp đi lặp lại. Ban đầu, mỗi cổ phiếu được coi là một cộng đồng riêng. Sau đó, thuật toán kiểm tra từng cổ phiếu và phân bổ lại nó vào cộng đồng lân cận mà việc di chuyển đó mang lại sự gia tăng lớn nhất về modularity – một thước đo mật độ các liên kết bên trong các cộng đồng so với các liên kết giữa các cộng đồng. Quá trình này được lặp lại cho đến khi không còn sự di chuyển nào cải thiện modularity. Khi giai đoạn này hoàn thành, mỗi cộng đồng được nén lại thành một “siêu nút” duy nhất, và quá trình phân bổ lại các siêu nút này được lặp lại.\nViệc tinh chỉnh và nén lặp đi lặp lại này tiếp tục cho đến khi cấu trúc cộng đồng ổn định. Trên thực tế, các cổ phiếu có tương quan cặp đôi cao, chẳng hạn như HPG, HSG và NKG, có xu hướng nhóm lại với nhau trong một cộng đồng “thép”, trong khi VCB, BID và CTG hợp nhất thành một cộng đồng “ngân hàng”. Sau vài lần lặp, Louvain thường hội tụ về một phân vùng ổn định của mạng lưới thành các cộng đồng dày đặc, được tách biệt rõ ràng, thường tương ứng với các lĩnh vực kinh tế rõ ràng như thép, ngân hàng hoặc công nghệ/bán lẻ (ví dụ: FPT, MWG), mà không yêu cầu các nhãn ngành được xác định trước.\nInfoMap Infomap xem mạng lưới như một quá trình đi ngẫu nhiên (random walk) qua các nút và cạnh và đi tối thiểu hoá độ không chắc chắn - uncertainty (entropy) của chuỗi di chuyển này.\n$$ L(M) = q_{\\curvearrowright}H(Q) + \\sum_{i=1}^{m} p_{\\circlearrowright}^{\\,i} \\, H(P^{i}) $$ $q_{\\curvearrowright}$: xác suất thoát khỏi một module H(Q): entropy của mã thoát $p_{\\circlearrowright}$: xác suất ở lại trong module i H(Pi): entropy của các di chuyển trong module Thuật toán Infomap tiếp cận việc phát hiện cộng đồng bằng cách mô phỏng một random walk (bước đi ngẫu nhiên) trên cùng network. Ý tưởng cốt lõi là một người đi ngẫu nhiên (random walker) có khả năng ở lại trong các vùng được kết nối dày đặc (dense) trong thời gian dài hơn. Bằng cách gán mã ngắn hơn cho các phân đoạn đường đi bên trong các cộng đồng này và mã dài hơn cho các chuyển đổi giữa các cộng đồng, thuật toán xác định hiệu quả các module.\nHãy hình dung random walker này có nhiều khả năng di chuyển giữa các cổ phiếu có tương quan cao. Thuật toán Infomap tìm cách chia mạng lưới thành các nhóm (cộng đồng) sao cho người đi bộ ngẫu nhiên có xu hướng ở lại trong cùng một nhóm trong thời gian dài. Khi người đi bộ di chuyển từ nhóm này sang nhóm khác, điều đó giống như việc cần “thông báo” rằng họ đã rời khỏi nhóm hiện tại và vào một nhóm mới. Infomap tìm cách phân chia mạng lưới sao cho số lần “thông báo” này (số lần di chuyển giữa các nhóm) được giảm thiểu. Các vùng mà người đi bộ dành phần lớn thời gian của họ - di chuyển qua lại giữa các cổ phiếu có liên quan chặt chẽ - được xác định là các module hoặc cộng đồng. Bởi vì người đi bộ mô phỏng có xu hướng “dừng chân” lâu hơn giữa các cổ phiếu tương quan cao, thuật toán này cũng có xu hướng nhóm HPG, HSG và NKG lại với nhau, và giữ bộ ba ngân hàng VCB, BID, CTG trong cùng một module.\nThuật toán Tối ưu tiêu chí Cách tiếp cận Ưu điểm Nhược điểm Louvain Modularity Q Greedy optimization Rất nhanh, hiệu quả, có thể áp dụng cho mạng lớn Có thể mắc kẹt ở tối ưu cục bộ, khó phát hiện cộng đồng nhỏ hoặc chồng lấn Infomap Entropy (Description Length) Random Walk Phân biệt tốt các cộng đồng nhỏ và chồng lấn, cho kết quả “kĩ” hơn Chạy chậm hơn Louvain, nhạy cảm với cấu trúc mạng và random. Đọc kĩ hơn 2 thuật toán này tại đây: https://www.statworx.com/en/content-hub/blog/community-detection-with-louvain-and-infomap\nTóm gọn lại, ta sẽ xây dựng mạng và sử dụng thuật toán community detection như sau\nB1: Xây dựng mạng (network) - Sử dụng PMFG\nB2: Tiến hành gom nhóm (coloring graph): Louvain hoặc InfoMap. 2 thuật toán có 2 cách tiếp cận khác nhau.\nMặc dù lý thuyết rất phức tạp, nhưng implement bằng python thì rất đơn giản vì rất nhiều thư viện hỗ trợ rồi! So lucky to be living in the 21st century.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 import igraph as ig import community as louvain import networkx as nx def build_pmfg(corr): tickers = corr.columns.tolist() N = len(tickers) dists = np.sqrt(2 * (1 - corr.values)) edges = [(i, j, dists[i, j]) for i in range(N) for j in range(i)] edges.sort(key=lambda x: x[2]) G = nx.Graph() G.add_nodes_from(range(N)) max_edges = 3 * (N - 2) for u, v, w in edges: if G.number_of_edges() \u003e= max_edges: break G.add_edge(u, v, weight=w) if not nx.check_planarity(G, False)[0]: G.remove_edge(u, v) return nx.relabel_nodes(G, dict(enumerate(tickers))) def detect_communities_infomap(G): tickers = list(G.nodes) g = ig.Graph() g.add_vertices(len(tickers)) g.vs[\"name\"] = tickers edges = [(tickers.index(u), tickers.index(v)) for u, v in G.edges()] weights = [1.0 / G[u][v][\"weight\"] for u, v in G.edges()] g.add_edges(edges) g.es[\"weight\"] = weights communities = g.community_infomap(edge_weights=\"weight\", trials=10) return [[g.vs[idx][\"name\"] for idx in comm] for comm in communities] def detect_communities_louvain(G): for u, v, d in G.edges(data=True): d['weight'] = 1.0 / d['weight'] partition = louvain.best_partition(G, weight='weight') comms = {} for node, cid in partition.items(): comms.setdefault(cid, []).append(node) return list(comms.values()) Experiments: VN100 Sau khi ta đã phân tích được các community của các cổ phiếu , ta thử nghiệm 1 chiến lược đơn giản: “Mua cổ phiếu có Sharpe cao nhất trong 300 ngày vừa qua của mỗi cụm và nắm giữ trong vòng 60 ngày tiếp theo”. Tỷ trọng sẽ được phân bổ đều (equal weighted) cho các cổ phiếu được chọn. Việc tái cân bằng danh mục được thực hiện sau mỗi 60 ngày.\nChiến lược này không nhằm “dự đoán giá cổ phiếu”, mà cung cấp một bộ lọc \u0026 phân bổ danh mục hợp lý dựa trên cấu trúc thị trường.\nSample danh mục hiện tại (2025-01-03)\nSố lượng Infomap Louvain 1 BMP BMP 2 LPB LPB 3 FPT FPT 4 CTD DBC 5 DBC VPI 6 IMP IMP 7 HCM KDH 8 KDH 9 TLG 2 chiến lược chỉ khác nhau phương pháp “community detection” mà sự khác biệt đã khác lớn đúng không!\nChiến lược Lợi nhuận hằng năm Biến động hằng năm Sharpe Max drawdown InfoMap 22.07 24.5 0.90 -42.85 Louvain 16.71 26.21 0.64 -47.26 VNINDEX 12.53 19.83 0.63 -40.34 Từ kết quả thử nghiệm trên, ta có thể thấy:\nChiến lược sử dụng InfoMap cho kết quả tốt hơn với Sharpe ratio 0.90, cao hơn đáng kể so với Louvain (0.64) và VNINDEX (0.63) Lợi nhuận hằng năm của InfoMap (22.07%) cũng vượt trội hơn Louvain (16.71%) và VNINDEX (12.53%) Tuy nhiên, biến động của cả hai chiến lược (24.5% và 26.21%) đều cao hơn VNINDEX (19.83%). Drawdown tối đa của hai chiến lược (-42.85% và -47.26%) cũng lớn hơn so với VNINDEX (-40.34%), phản ánh rủi ro giảm giá lớn hơn Tuy nhiên, rủi ro có thể được hạn chế nếu sử dụng các phương pháp tối ưu hoá khác so với equal weighted như thử nghiệm này.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 def select_portfolio(returns_window, communities): sharpe = returns_window.mean() / returns_window.std() K = len(communities) weights = {} for comm in communities: best = sharpe[comm].idxmax() weights[best] = 1.0 / K return weights def backtest_and_save(df, method=\"infomap\", window=300, step=60): df = df.ffill().dropna(axis=1) returns = compute_returns(df) portfolios, metrics, all_returns = {}, [], [] for t in range(window, len(returns), step): if t + step \u003e len(returns): break label = returns.index[t].strftime(\"%Y-%m-%d\") windowed = returns.iloc[t-window:t] out = returns.iloc[t:t+step] G = build_pmfg(windowed.corr()) if method == \"infomap\": comms = detect_communities_infomap(G) elif method == \"louvain\": comms = detect_communities_louvain(G) else: raise ValueError(\"Unknown method\") weights = select_portfolio(windowed, comms) portfolios[label] = weights visualize_and_save(G, comms, label, method) port_series = out[list(weights)].dot(pd.Series(weights)).rename(\"rets\") port_series = port_series.reset_index().rename(columns={\"index\": \"timestamps\"}) all_returns.append(port_series) cum = (1+port_series[\"rets\"]).prod()-1 vol = port_series[\"rets\"].std()*np.sqrt(252) sr = port_series[\"rets\"].mean()/port_series[\"rets\"].std()*np.sqrt(252) metrics.append({\"period\": label, \"CumReturn\": cum, \"Volatility\": vol, \"Sharpe\": sr}) final_df = pd.concat(all_returns, axis=0).reset_index(drop=True) final_df.to_csv(f\"data/{method}/raw_returns.csv\", index=False) pd.DataFrame(metrics).set_index(\"period\").to_csv(f\"data/{method}/metrics.csv\") with open(f\"data/{method}/portfolios.json\", \"w\") as f: json.dump(portfolios, f, indent=2) Ngoài ra, InfoMap có hiệu suất tốt hơn trong trường hợp này. Louvain thường có xu hướng gom các nhóm lại thành cộng đồng lớn, do thuật toán ưu tiên tối đa hóa modularity – một đại lượng có thể bị “bẫy tối ưu cục bộ”, dẫn đến cộng đồng bị trộn lẫn (ví dụ: nhóm cổ phiếu ngân hàng có thể bị gom chung với cổ phiếu tài chính hoặc bảo hiểm). Trong khi đó, Infomap, nhờ đặc tính tối ưu “entropy”, thường tách rời được các nhóm hoạt động chặt chẽ hơn, như nhóm “thép”, “ngân hàng”, hay “bán lẻ - công nghệ” mà không bị pha tạp.\nNgoài ra, còn rất nhiều thuật toán community detection khác như : Walktrap, Clique Percolation Method, Leiden,.. mà bạn đọc có thể thử nghiệm.\nThuật toán Tối ưu tiêu chí Cách tiếp cận Ưu điểm Nhược điểm Louvain Modularity Q Heuristic Rất nhanh, hiệu quả, có thể áp dụng cho mạng lớn Có thể mắc kẹt ở tối ưu cục bộ, khó phát hiện cộng đồng nhỏ hoặc chồng lấn Infomap Entropy (Description Length) Random Walk Phân biệt tốt các cộng đồng nhỏ và chồng lấn, cho kết quả sắc nét hơn Chạy chậm hơn Louvain, nhạy cảm với cấu trúc mạng và ngẫu nhiên hóa Conclusion Nghiên cứu này thử nghiệm việc áp dụng network theory và community detection trong thị trường chứng khoán Việt Nam (VN100). Kết quả cho thấy:\nPhương pháp phát hiện cộng đồng có thể giúp hiểu rõ hơn về cấu trúc thị trường và mối quan hệ giữa các cổ phiếu Chiến lược đầu tư dựa trên InfoMap cho kết quả vượt trội hơn so với Louvain và VNINDEX về mặt Sharpe ratio và lợi nhuận Tuy nhiên, các chiến lược này cũng đi kèm với rủi ro cao hơn thể hiện qua biến động và drawdown lớn hơn Nghiên cứu này mở ra hướng phát triển tiếp theo bằng cách:\nThử nghiệm các thuật toán phát hiện cộng đồng khác Áp dụng các phương pháp tối ưu hóa danh mục đầu tư thay vì phân bổ đều Kết hợp với các chỉ báo kỹ thuật khác để cải thiện hiệu suất Cuối cùng, phương pháp này có thể được sử dụng như một công cụ hỗ trợ trong việc ra quyết định đầu tư, không nên được sử dụng một cách độc lập mà nên kết hợp với các phương pháp phân tích khác.\nReference [1] https://arxiv.org/pdf/2112.13383\n[2] https://gmarti.gitlab.io/networks/2018/06/03/pmfg-algorithm.html\n[3] https://www.statworx.com/en/content-hub/blog/community-detection-with-louvain-and-infomap\n[4] ChatGPT o3 :)\n","wordCount":"3244","inLanguage":"vi","datePublished":"2025-05-19T00:00:00Z","dateModified":"2025-05-19T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/2025/2025-05-17-stock-market-network/"},"publisher":{"@type":"Organization","name":"The Financial Engineer","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="The Financial Engineer (Alt + H)">The Financial Engineer</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/about/ title=About><span>About</span></a></li><li><a href=http://localhost:1313/archives/ title=Archive><span>Archive</span></a></li><li><a href=http://localhost:1313/tags/ title=Tags><span>Tags</span></a></li><li><a href=http://localhost:1313/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Community detection for VN100</h1><div class=post-description>Thử nghiệm xây dựng chiến lược dựa trên thuật toán community detection</div><div class=post-meta><span title='2025-05-19 00:00:00 +0000 UTC'>tháng 5 19, 2025</span>&nbsp;·&nbsp;16 phút</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Mục lục</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#concept>Concept</a></li><li><a href=#starting-simple-correlation-matrix>Starting simple, correlation matrix</a><ul><li><a href=#correlation-what-is-it>Correlation: what is it?</a></li><li><a href=#from-correlation-to-network-and-community>From correlation to network and community</a></li></ul></li><li><a href=#theory--mathematical-model>Theory & Mathematical model</a><ul><li><a href=#planar-maximally-filtered-graph-pmfg>Planar Maximally Filtered Graph (PMFG)</a></li><li><a href=#community-detection>Community detection</a></li><li><a href=#louvain>Louvain</a></li><li><a href=#infomap>InfoMap</a></li></ul></li><li><a href=#experiments-vn100>Experiments: VN100</a><ul><li><a href=#conclusion>Conclusion</a></li><li><a href=#reference>Reference</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p><img loading=lazy src=images/cover.png alt=cover>
Bài viết này thử nghiệm bài toán “Community detection” cho thị trường chứng khoán Việt Nam (VN100) và backtest 1 chiến lược dựa trên thuật toán này.</p><p>Bài viết được lấy ý tưởng từ: <a href=https://arxiv.org/pdf/2112.13383>https://arxiv.org/pdf/2112.13383</a></p><p>Để lấy file code và dữ liệu, vui lòng gửi email tới <a href=mailto:hung.ha@miquant.vn>hung.ha@miquant.vn</a></p><h2 id=concept>Concept<a hidden class=anchor aria-hidden=true href=#concept>#</a></h2><p>Trong một môi trường có nhiều yếu tố tương tác với nhau, sự tương quan (thể hiện qua xu hướng biến động giống nhau) là điều tất yếu, và thị trường chứng khoán cũng không ngoại lệ. Mặc dù mối tương quan giữa các cổ phiếu đã được biết đến từ lâu, nhưng phải đến khi Harry Markowitz giới thiệu Lý thuyết Danh mục Đầu tư Hiện đại vào năm 1952, nó mới được áp dụng rộng rãi. Lý thuyết này đề xuất phương pháp định lượng để tối ưu hóa danh mục đầu tư dựa trên mối tương quan giữa các tài sản. Kể từ đó, việc nghiên cứu mối liên hệ giữa các cổ phiếu đã phát triển theo nhiều hướng, trong đó việc áp dụng lý thuyết mạng (Network Theory) nổi lên như một phương pháp hiệu quả và đang được đặc biệt quan tâm trong giai đoạn đầy biến động này.</p><h2 id=starting-simple-correlation-matrix>Starting simple, correlation matrix<a hidden class=anchor aria-hidden=true href=#starting-simple-correlation-matrix>#</a></h2><h3 id=correlation-what-is-it>Correlation: what is it?<a hidden class=anchor aria-hidden=true href=#correlation-what-is-it>#</a></h3><p><img loading=lazy src=images/correlation.png alt=correlation.png></p><p>Tương quan (correlation) là một chỉ số thống kê đo lường mức độ biến động đồng thời giữa hai biến số. Trong thị trường chứng khoán, tương quan thường được sử dụng để đánh giá mối liên hệ giữa giá của các cổ phiếu.</p><p>Công thức tính hệ số tương quan Pearson:</p>$$
r = \frac{\sum_{i=1}^{n} (x_i - \bar{x})(y_i - \bar{y})}{\sqrt{\sum_{i=1}^{n} (x_i - \bar{x})^2}\sqrt{\sum_{i=1}^{n} (y_i - \bar{y})^2}}
$$<p>Nói một cách đơn giản, tương quan giữa các cổ phiếu thể hiện mức độ &ldquo;đồng hành&rdquo; của chúng. Khi hai cổ phiếu có tương quan cao (gần 1), chúng thường tăng giảm cùng nhau—ví dụ, khi một cổ phiếu tăng 5%, cổ phiếu kia cũng có xu hướng tăng tương tự. Ngược lại, tương quan âm (gần -1) nghĩa là khi cổ phiếu này tăng, cổ phiếu kia thường giảm. Tương quan bằng 0 không đồng nghĩa với việc hai cổ phiếu không liên quan đến nhau, mà chỉ cho thấy không có mối liên hệ tuyến tính rõ ràng trong biến động giá của chúng.</p><p>Bài viết minh họa điều này qua việc so sánh tương quan giữa HPG với HSG và BWE. Với hệ số tương quan 0,8 (tính trên hiệu suất tuần), HPG và HSG có mối tương quan mạnh. Điều này dễ hiểu bởi cả hai đều là doanh nghiệp sản xuất thép, chịu tác động từ cùng các yếu tố thị trường như giá nguyên liệu đầu vào và nhu cầu xây dựng. Ngược lại, HPG và BWE chỉ có hệ số tương quan 0,2, cho thấy sự khác biệt trong mô hình kinh doanh và các yếu tố ảnh hưởng đến giá cổ phiếu của hai doanh nghiệp.</p><p>Qua đó có thể thấy, các cổ phiếu cùng ngành (hay rộng hơn là có chung các yếu tố cơ bản) thường phản ánh xu hướng biến động giá và rủi ro tương tự nhau, do nhà đầu tư thường định giá và quyết định dựa trên những yếu tố tương đồng. Hiện tượng này tạo ra hiệu ứng &ldquo;cộng hưởng&rdquo; trong biến động giá, khiến các cổ phiếu cùng nhóm ngành thường di chuyển đồng thời với nhau. Đây chính là nguồn gốc của rủi ro hệ thống (systematic risk).</p><p><img loading=lazy src=images/corr.png alt=image.png></p><p>Khi mở rộng phân tích từ một vài cổ phiếu lên hàng chục, thậm chí hàng trăm mã (ví dụ như VN100), phương pháp chỉ dựa vào ma trận tương quan thuần túy sẽ gặp phải nhiều hạn chế sau:</p><ol><li><strong>Curse of dimensionality</strong>
Với $N$ tài sản, ta phải tính tới $\tfrac{N(N-1)}{2}$ cặp tương quan. Khi $\tfrac{N(N-1)}{2}$, con số này lên tới 4.950 cặp — vượt ra ngoài khả năng trực quan hóa và so sánh thủ công, dẫn đến “quá tải thông tin”.</li><li><strong>Noise và sai số ước lượng lớn</strong>
Dữ liệu giá luôn chứa nhiều nhiễu và có tính không ổn định theo thời gian. Khi số tài sản tăng, sai số ước lượng hệ số tương quan (nhất là với mẫu nhỏ) càng lớn, dễ sinh ra các giá trị tương quan “giả” (spurious), từ đó gây hiểu nhầm về mối quan hệ giữa các cổ phiếu.</li><li><strong>Khó trích xuất cấu trúc</strong>
Ma trận tương quan thuần túy thường rất “đậm đặc” (dense) — hầu như mọi cặp đều có tương quan khác 0. Điều này khiến khó khăn trong việc phân nhóm (clustering) hay tìm kiếm các cấu trúc ẩn (hidden pattern), vì không có điểm nhấn rõ nét để tách biệt các khối tài sản liên quan chặt chẽ.</li></ol><h3 id=from-correlation-to-network-and-community>From correlation to network and community<a hidden class=anchor aria-hidden=true href=#from-correlation-to-network-and-community>#</a></h3><p>Con người vốn quen mô tả thế giới qua các <strong>thực thể (node)</strong> và <strong>mối quan hệ (edge)</strong>: trong mạng xã hội, mỗi người là một nút, các liên hệ &ldquo;kết bạn&rdquo;, &ldquo;theo dõi&rdquo; tạo thành cạnh, và nhờ đó ta dễ dàng nhận ra gia đình, nhóm bạn, hay những nhân vật trung tâm chỉ bằng cách quan sát cấu trúc kết nối.</p><p>Tư duy trực quan này được áp dụng cho thị trường chứng khoán: thay vì xem xét từng cặp hệ số tương quan riêng lẻ, ta biến mỗi cổ phiếu thành một nút (node) và dùng đường nối (edge) thể hiện mức độ liên hệ về giá. Kết quả là một &ldquo;bản đồ&rdquo; mạng lưới, nơi các nhóm cổ phiếu cùng ngành hay cùng chu kỳ kinh doanh tự động hiện ra như những cộng đồng trong mạng xã hội. Điều này giúp nhà đầu tư nhanh chóng nắm bắt được các mối liên hệ, xác định được những cổ phiếu đóng vai trò &ldquo;cầu nối&rdquo; và nhận diện được các tâm điểm rủi ro – cơ hội mà không cần đi sâu vào khối dữ liệu đồ sộ của ma trận tương quan.</p><p><img loading=lazy src=images/sample_net.png alt=image.png></p><h2 id=theory--mathematical-model>Theory & Mathematical model<a hidden class=anchor aria-hidden=true href=#theory--mathematical-model>#</a></h2><p>Để biến đổi từ correlation matrix thành 1 network, bước 1 ta cần biến đổi từ cấu trúc matrix thành cấu trúc network. Sau đó, từ network tạo ra, ta tiến hành gom nhóm các cổ phiếu giống nhau lại.</p><p>Để xây dựng 1 network, 2 thuật toán nổi tiếng là Planar Maximally Filtered Graph và Minimum Spanning Tree.</p><h3 id=planar-maximally-filtered-graph-pmfg>Planar Maximally Filtered Graph (PMFG)<a hidden class=anchor aria-hidden=true href=#planar-maximally-filtered-graph-pmfg>#</a></h3><p>PMFG giữ lại các liên kết quan trọng nhất trong khi buộc đồ thị phải duy trì tính <strong>phẳng (planar)</strong> (có thể vẽ trên một tờ giấy mà không có cạnh nào cắt nhau). Vì một đồ thị phẳng chỉ có thể có tối đa $E_{\text{PMFG}} = 3(N-2)$ cạnh, bộ lọc thu gọn mạng lưới một cách đáng kể (nhưng vẫn bảo toàn được gấp ba lần thông tin so với Minimum Spanning Tree, vốn chỉ có $N-1$ cạnh) (đọc kĩ hơn tại đây: <a href=https://gmarti.gitlab.io/networks/2018/06/03/pmfg-algorithm.html)>https://gmarti.gitlab.io/networks/2018/06/03/pmfg-algorithm.html)</a>.</p><p>Kết quả thu được sẽ giữ lại <strong>cấu trúc cốt lõi</strong> của các mối quan hệ mạnh nhất :). In a simple way, thay vì giữ toàn bộ N*(N-1)/2 thì giờ chỉ còn tối đa 3(N-2) cạnh (mối quan hệ), tương đương với 3*(100-2) = 294 cạnh so với 4950 (giảm 16 lần)</p><p>Input của PMFG hay MST trong trường hợp này đều là correlation matrix.</p><h3 id=community-detection>Community detection<a hidden class=anchor aria-hidden=true href=#community-detection>#</a></h3><p>Sau khi đã có mạng PMFG tinh gọn, bước tiếp theo là chia mạng thành những “cụm” (community) cổ phiếu giống nhau. Hai cách phổ biến nhất là <strong>Louvain</strong> (tối ưu modularity) và <strong>Infomap</strong> (tối ưu dòng ngẫu nhiên).</p><h3 id=louvain>Louvain<a hidden class=anchor aria-hidden=true href=#louvain>#</a></h3><p>Louvain chia mạng thành cộng đồng bằng cách <strong>tối đa hóa chỉ số modularity Q</strong> – thước đo so sánh mật độ liên kết <strong>trong</strong> cộng đồng với mật độ mong đợi nếu các cạnh được nối ngẫu nhiên.</p>$$
Q = \frac{1}{2m}\sum_{i,j}\Bigl(A_{ij} - \frac{k_i k_j}{2m}\Bigr)\delta(c_i,c_j),
$$<p>trong đó:</p><ul><li>Aij = trọng số của cạnh giữa i và j,</li><li>ki = tổng trọng số gắn với nút i,</li><li>m = tổng trọng số cạnh,</li><li>δ(ci,cj) = 1 nếu các nút cùng cộng đồng.</li></ul><p><strong>Thuật toán Louvain</strong> hoạt động lặp đi lặp lại. Ban đầu, mỗi cổ phiếu được coi là một cộng đồng riêng. Sau đó, thuật toán kiểm tra từng cổ phiếu và phân bổ lại nó vào cộng đồng lân cận mà việc di chuyển đó mang lại sự gia tăng lớn nhất về <strong>modularity</strong> – một thước đo mật độ các liên kết bên trong các cộng đồng so với các liên kết giữa các cộng đồng. Quá trình này được lặp lại cho đến khi không còn sự di chuyển nào cải thiện <strong>modularity</strong>. Khi giai đoạn này hoàn thành, mỗi cộng đồng được nén lại thành một &ldquo;siêu nút&rdquo; duy nhất, và quá trình phân bổ lại các siêu nút này được lặp lại.</p><p>Việc tinh chỉnh và nén lặp đi lặp lại này tiếp tục cho đến khi cấu trúc cộng đồng ổn định. Trên thực tế, các cổ phiếu có tương quan cặp đôi cao, chẳng hạn như HPG, HSG và NKG, có xu hướng nhóm lại với nhau trong một cộng đồng &ldquo;thép&rdquo;, trong khi VCB, BID và CTG hợp nhất thành một cộng đồng &ldquo;ngân hàng&rdquo;. Sau vài lần lặp, Louvain thường hội tụ về một phân vùng ổn định của mạng lưới thành các cộng đồng dày đặc, được tách biệt rõ ràng, thường tương ứng với các lĩnh vực kinh tế rõ ràng như thép, ngân hàng hoặc công nghệ/bán lẻ (ví dụ: FPT, MWG), mà không yêu cầu các nhãn ngành được xác định trước.</p><h3 id=infomap>InfoMap<a hidden class=anchor aria-hidden=true href=#infomap>#</a></h3><p>Infomap xem mạng lưới như một <strong>quá trình đi ngẫu nhiên (random walk)</strong> qua các nút và cạnh và đi tối thiểu hoá độ không chắc chắn - uncertainty (entropy) của chuỗi di chuyển này.</p>$$
L(M) = q_{\curvearrowright}H(Q) + \sum_{i=1}^{m} p_{\circlearrowright}^{\,i} \, H(P^{i})
$$<ul><li>$q_{\curvearrowright}$: xác suất thoát khỏi một module</li><li>H(Q): entropy của mã thoát</li><li>$p_{\circlearrowright}$: xác suất ở lại trong module i</li><li>H(Pi): entropy của các di chuyển trong module</li></ul><p><strong>Thuật toán Infomap</strong> tiếp cận việc phát hiện cộng đồng bằng cách mô phỏng một <strong>random walk</strong> (bước đi ngẫu nhiên) trên cùng network. Ý tưởng cốt lõi là một người đi ngẫu nhiên (random walker) có khả năng ở lại trong các vùng được kết nối dày đặc (dense) trong thời gian dài hơn. Bằng cách gán mã ngắn hơn cho các phân đoạn đường đi bên trong các cộng đồng này và mã dài hơn cho các chuyển đổi giữa các cộng đồng, thuật toán xác định hiệu quả các module.</p><p>Hãy hình dung random walker này có nhiều khả năng di chuyển giữa các cổ phiếu có tương quan cao. Thuật toán Infomap tìm cách chia mạng lưới thành các nhóm (cộng đồng) sao cho người đi bộ ngẫu nhiên có xu hướng ở lại trong cùng một nhóm trong thời gian dài. Khi người đi bộ di chuyển từ nhóm này sang nhóm khác, điều đó giống như việc cần &ldquo;thông báo&rdquo; rằng họ đã rời khỏi nhóm hiện tại và vào một nhóm mới. Infomap tìm cách phân chia mạng lưới sao cho số lần &ldquo;thông báo&rdquo; này (số lần di chuyển giữa các nhóm) được giảm thiểu. Các vùng mà người đi bộ dành phần lớn thời gian của họ - di chuyển qua lại giữa các cổ phiếu có liên quan chặt chẽ - được xác định là các module hoặc cộng đồng. Bởi vì người đi bộ mô phỏng có xu hướng &ldquo;dừng chân&rdquo; lâu hơn giữa các cổ phiếu tương quan cao, thuật toán này cũng có xu hướng nhóm HPG, HSG và NKG lại với nhau, và giữ bộ ba ngân hàng VCB, BID, CTG trong cùng một module.</p><table><thead><tr><th style=text-align:left><strong>Thuật toán</strong></th><th style=text-align:left><strong>Tối ưu tiêu chí</strong></th><th style=text-align:left><strong>Cách tiếp cận</strong></th><th style=text-align:left><strong>Ưu điểm</strong></th><th style=text-align:left><strong>Nhược điểm</strong></th></tr></thead><tbody><tr><td style=text-align:left><strong>Louvain</strong></td><td style=text-align:left>Modularity Q</td><td style=text-align:left>Greedy optimization</td><td style=text-align:left>Rất nhanh, hiệu quả, có thể áp dụng cho mạng lớn</td><td style=text-align:left>Có thể mắc kẹt ở tối ưu cục bộ, khó phát hiện cộng đồng nhỏ hoặc chồng lấn</td></tr><tr><td style=text-align:left><strong>Infomap</strong></td><td style=text-align:left>Entropy (Description Length)</td><td style=text-align:left>Random Walk</td><td style=text-align:left>Phân biệt tốt các cộng đồng nhỏ và chồng lấn, cho kết quả “kĩ” hơn</td><td style=text-align:left>Chạy chậm hơn Louvain, nhạy cảm với cấu trúc mạng và random.</td></tr></tbody></table><p>Đọc kĩ hơn 2 thuật toán này tại đây: <a href=https://www.statworx.com/en/content-hub/blog/community-detection-with-louvain-and-infomap>https://www.statworx.com/en/content-hub/blog/community-detection-with-louvain-and-infomap</a></p><p>Tóm gọn lại, ta sẽ xây dựng mạng và sử dụng thuật toán community detection như sau</p><p>B1: Xây dựng mạng (network) - Sử dụng PMFG</p><p>B2: Tiến hành gom nhóm (coloring graph): Louvain hoặc InfoMap. 2 thuật toán có 2 cách tiếp cận khác nhau.</p><p><img loading=lazy src=images/community.png alt=community.png></p><p>Mặc dù lý thuyết rất phức tạp, nhưng implement bằng python thì rất đơn giản vì rất nhiều thư viện hỗ trợ rồi! So lucky to be living in the 21st century.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>import</span> igraph <span style=color:#66d9ef>as</span> ig
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> community <span style=color:#66d9ef>as</span> louvain
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> networkx <span style=color:#66d9ef>as</span> nx
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>build_pmfg</span>(corr):
</span></span><span style=display:flex><span>    tickers <span style=color:#f92672>=</span> corr<span style=color:#f92672>.</span>columns<span style=color:#f92672>.</span>tolist()
</span></span><span style=display:flex><span>    N <span style=color:#f92672>=</span> len(tickers)
</span></span><span style=display:flex><span>    dists <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>sqrt(<span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> corr<span style=color:#f92672>.</span>values))
</span></span><span style=display:flex><span>    edges <span style=color:#f92672>=</span> [(i, j, dists[i, j]) <span style=color:#66d9ef>for</span> i <span style=color:#f92672>in</span> range(N) <span style=color:#66d9ef>for</span> j <span style=color:#f92672>in</span> range(i)]
</span></span><span style=display:flex><span>    edges<span style=color:#f92672>.</span>sort(key<span style=color:#f92672>=</span><span style=color:#66d9ef>lambda</span> x: x[<span style=color:#ae81ff>2</span>])
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    G <span style=color:#f92672>=</span> nx<span style=color:#f92672>.</span>Graph()
</span></span><span style=display:flex><span>    G<span style=color:#f92672>.</span>add_nodes_from(range(N))
</span></span><span style=display:flex><span>    max_edges <span style=color:#f92672>=</span> <span style=color:#ae81ff>3</span> <span style=color:#f92672>*</span> (N <span style=color:#f92672>-</span> <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> u, v, w <span style=color:#f92672>in</span> edges:
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> G<span style=color:#f92672>.</span>number_of_edges() <span style=color:#f92672>&gt;=</span> max_edges: <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>        G<span style=color:#f92672>.</span>add_edge(u, v, weight<span style=color:#f92672>=</span>w)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#f92672>not</span> nx<span style=color:#f92672>.</span>check_planarity(G, <span style=color:#66d9ef>False</span>)[<span style=color:#ae81ff>0</span>]:
</span></span><span style=display:flex><span>            G<span style=color:#f92672>.</span>remove_edge(u, v)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> nx<span style=color:#f92672>.</span>relabel_nodes(G, dict(enumerate(tickers)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>detect_communities_infomap</span>(G):
</span></span><span style=display:flex><span>    tickers <span style=color:#f92672>=</span> list(G<span style=color:#f92672>.</span>nodes)
</span></span><span style=display:flex><span>    g <span style=color:#f92672>=</span> ig<span style=color:#f92672>.</span>Graph()
</span></span><span style=display:flex><span>    g<span style=color:#f92672>.</span>add_vertices(len(tickers))
</span></span><span style=display:flex><span>    g<span style=color:#f92672>.</span>vs[<span style=color:#e6db74>&#34;name&#34;</span>] <span style=color:#f92672>=</span> tickers
</span></span><span style=display:flex><span>    edges <span style=color:#f92672>=</span> [(tickers<span style=color:#f92672>.</span>index(u), tickers<span style=color:#f92672>.</span>index(v)) <span style=color:#66d9ef>for</span> u, v <span style=color:#f92672>in</span> G<span style=color:#f92672>.</span>edges()]
</span></span><span style=display:flex><span>    weights <span style=color:#f92672>=</span> [<span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> G[u][v][<span style=color:#e6db74>&#34;weight&#34;</span>] <span style=color:#66d9ef>for</span> u, v <span style=color:#f92672>in</span> G<span style=color:#f92672>.</span>edges()]
</span></span><span style=display:flex><span>    g<span style=color:#f92672>.</span>add_edges(edges)
</span></span><span style=display:flex><span>    g<span style=color:#f92672>.</span>es[<span style=color:#e6db74>&#34;weight&#34;</span>] <span style=color:#f92672>=</span> weights
</span></span><span style=display:flex><span>    communities <span style=color:#f92672>=</span> g<span style=color:#f92672>.</span>community_infomap(edge_weights<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;weight&#34;</span>, trials<span style=color:#f92672>=</span><span style=color:#ae81ff>10</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> [[g<span style=color:#f92672>.</span>vs[idx][<span style=color:#e6db74>&#34;name&#34;</span>] <span style=color:#66d9ef>for</span> idx <span style=color:#f92672>in</span> comm] <span style=color:#66d9ef>for</span> comm <span style=color:#f92672>in</span> communities]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>detect_communities_louvain</span>(G):
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> u, v, d <span style=color:#f92672>in</span> G<span style=color:#f92672>.</span>edges(data<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>):
</span></span><span style=display:flex><span>        d[<span style=color:#e6db74>&#39;weight&#39;</span>] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> d[<span style=color:#e6db74>&#39;weight&#39;</span>]
</span></span><span style=display:flex><span>    partition <span style=color:#f92672>=</span> louvain<span style=color:#f92672>.</span>best_partition(G, weight<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;weight&#39;</span>)
</span></span><span style=display:flex><span>    comms <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> node, cid <span style=color:#f92672>in</span> partition<span style=color:#f92672>.</span>items():
</span></span><span style=display:flex><span>        comms<span style=color:#f92672>.</span>setdefault(cid, [])<span style=color:#f92672>.</span>append(node)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> list(comms<span style=color:#f92672>.</span>values())
</span></span></code></pre></td></tr></table></div></div><h2 id=experiments-vn100>Experiments: VN100<a hidden class=anchor aria-hidden=true href=#experiments-vn100>#</a></h2><p>Sau khi ta đã phân tích được các community của các cổ phiếu , ta thử nghiệm 1 chiến lược đơn giản: “Mua cổ phiếu có Sharpe cao nhất trong 300 ngày vừa qua của mỗi cụm và nắm giữ trong vòng 60 ngày tiếp theo”. Tỷ trọng sẽ được phân bổ đều (equal weighted) cho các cổ phiếu được chọn. Việc tái cân bằng danh mục được thực hiện sau mỗi 60 ngày.</p><p>Chiến lược này không nhằm “dự đoán giá cổ phiếu”, mà cung cấp một bộ lọc & phân bổ danh mục hợp lý dựa trên cấu trúc thị trường.</p><p>Sample danh mục hiện tại (2025-01-03)</p><table><thead><tr><th style=text-align:left>Số lượng</th><th style=text-align:left>Infomap</th><th style=text-align:left>Louvain</th></tr></thead><tbody><tr><td style=text-align:left>1</td><td style=text-align:left>BMP</td><td style=text-align:left>BMP</td></tr><tr><td style=text-align:left>2</td><td style=text-align:left>LPB</td><td style=text-align:left>LPB</td></tr><tr><td style=text-align:left>3</td><td style=text-align:left>FPT</td><td style=text-align:left>FPT</td></tr><tr><td style=text-align:left>4</td><td style=text-align:left>CTD</td><td style=text-align:left>DBC</td></tr><tr><td style=text-align:left>5</td><td style=text-align:left>DBC</td><td style=text-align:left>VPI</td></tr><tr><td style=text-align:left>6</td><td style=text-align:left>IMP</td><td style=text-align:left>IMP</td></tr><tr><td style=text-align:left>7</td><td style=text-align:left>HCM</td><td style=text-align:left>KDH</td></tr><tr><td style=text-align:left>8</td><td style=text-align:left>KDH</td><td style=text-align:left></td></tr><tr><td style=text-align:left>9</td><td style=text-align:left>TLG</td><td style=text-align:left></td></tr></tbody></table><p>2 chiến lược chỉ khác nhau phương pháp “community detection” mà sự khác biệt đã khác lớn đúng không!</p><p><img loading=lazy src=images/backtest.png alt=image.png></p><table><thead><tr><th style=text-align:left>Chiến lược</th><th style=text-align:left>Lợi nhuận hằng năm</th><th style=text-align:left>Biến động hằng năm</th><th style=text-align:left>Sharpe</th><th style=text-align:left>Max drawdown</th></tr></thead><tbody><tr><td style=text-align:left>InfoMap</td><td style=text-align:left>22.07</td><td style=text-align:left>24.5</td><td style=text-align:left>0.90</td><td style=text-align:left>-42.85</td></tr><tr><td style=text-align:left>Louvain</td><td style=text-align:left>16.71</td><td style=text-align:left>26.21</td><td style=text-align:left>0.64</td><td style=text-align:left>-47.26</td></tr><tr><td style=text-align:left>VNINDEX</td><td style=text-align:left>12.53</td><td style=text-align:left>19.83</td><td style=text-align:left>0.63</td><td style=text-align:left>-40.34</td></tr></tbody></table><p>Từ kết quả thử nghiệm trên, ta có thể thấy:</p><ul><li>Chiến lược sử dụng InfoMap cho kết quả tốt hơn với Sharpe ratio 0.90, cao hơn đáng kể so với Louvain (0.64) và VNINDEX (0.63)</li><li>Lợi nhuận hằng năm của InfoMap (22.07%) cũng vượt trội hơn Louvain (16.71%) và VNINDEX (12.53%)</li><li>Tuy nhiên, biến động của cả hai chiến lược (24.5% và 26.21%) đều cao hơn VNINDEX (19.83%).</li><li>Drawdown tối đa của hai chiến lược (-42.85% và -47.26%) cũng lớn hơn so với VNINDEX (-40.34%), phản ánh rủi ro giảm giá lớn hơn</li></ul><p>Tuy nhiên, rủi ro có thể được hạn chế nếu sử dụng các phương pháp tối ưu hoá khác so với equal weighted như thử nghiệm này.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">47
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>select_portfolio</span>(returns_window, communities):
</span></span><span style=display:flex><span>    sharpe <span style=color:#f92672>=</span> returns_window<span style=color:#f92672>.</span>mean() <span style=color:#f92672>/</span> returns_window<span style=color:#f92672>.</span>std()
</span></span><span style=display:flex><span>    K <span style=color:#f92672>=</span> len(communities)
</span></span><span style=display:flex><span>    weights <span style=color:#f92672>=</span> {}
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> comm <span style=color:#f92672>in</span> communities:
</span></span><span style=display:flex><span>        best <span style=color:#f92672>=</span> sharpe[comm]<span style=color:#f92672>.</span>idxmax()
</span></span><span style=display:flex><span>        weights[best] <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.0</span> <span style=color:#f92672>/</span> K
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> weights
</span></span><span style=display:flex><span>   
</span></span><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>backtest_and_save</span>(df, method<span style=color:#f92672>=</span><span style=color:#e6db74>&#34;infomap&#34;</span>, window<span style=color:#f92672>=</span><span style=color:#ae81ff>300</span>, step<span style=color:#f92672>=</span><span style=color:#ae81ff>60</span>):
</span></span><span style=display:flex><span>    df <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>ffill()<span style=color:#f92672>.</span>dropna(axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>    returns <span style=color:#f92672>=</span> compute_returns(df)
</span></span><span style=display:flex><span>    portfolios, metrics, all_returns <span style=color:#f92672>=</span> {}, [], []
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> t <span style=color:#f92672>in</span> range(window, len(returns), step):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> t <span style=color:#f92672>+</span> step <span style=color:#f92672>&gt;</span> len(returns): <span style=color:#66d9ef>break</span>
</span></span><span style=display:flex><span>        label <span style=color:#f92672>=</span> returns<span style=color:#f92672>.</span>index[t]<span style=color:#f92672>.</span>strftime(<span style=color:#e6db74>&#34;%Y-%m-</span><span style=color:#e6db74>%d</span><span style=color:#e6db74>&#34;</span>)
</span></span><span style=display:flex><span>        windowed <span style=color:#f92672>=</span> returns<span style=color:#f92672>.</span>iloc[t<span style=color:#f92672>-</span>window:t]
</span></span><span style=display:flex><span>        out <span style=color:#f92672>=</span> returns<span style=color:#f92672>.</span>iloc[t:t<span style=color:#f92672>+</span>step]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        G <span style=color:#f92672>=</span> build_pmfg(windowed<span style=color:#f92672>.</span>corr())
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;infomap&#34;</span>:
</span></span><span style=display:flex><span>            comms <span style=color:#f92672>=</span> detect_communities_infomap(G)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>elif</span> method <span style=color:#f92672>==</span> <span style=color:#e6db74>&#34;louvain&#34;</span>:
</span></span><span style=display:flex><span>            comms <span style=color:#f92672>=</span> detect_communities_louvain(G)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>raise</span> <span style=color:#a6e22e>ValueError</span>(<span style=color:#e6db74>&#34;Unknown method&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        weights <span style=color:#f92672>=</span> select_portfolio(windowed, comms)
</span></span><span style=display:flex><span>        portfolios[label] <span style=color:#f92672>=</span> weights
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        visualize_and_save(G, comms, label, method)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        port_series <span style=color:#f92672>=</span> out[list(weights)]<span style=color:#f92672>.</span>dot(pd<span style=color:#f92672>.</span>Series(weights))<span style=color:#f92672>.</span>rename(<span style=color:#e6db74>&#34;rets&#34;</span>)
</span></span><span style=display:flex><span>        port_series <span style=color:#f92672>=</span> port_series<span style=color:#f92672>.</span>reset_index()<span style=color:#f92672>.</span>rename(columns<span style=color:#f92672>=</span>{<span style=color:#e6db74>&#34;index&#34;</span>: <span style=color:#e6db74>&#34;timestamps&#34;</span>})
</span></span><span style=display:flex><span>        all_returns<span style=color:#f92672>.</span>append(port_series)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        cum <span style=color:#f92672>=</span> (<span style=color:#ae81ff>1</span><span style=color:#f92672>+</span>port_series[<span style=color:#e6db74>&#34;rets&#34;</span>])<span style=color:#f92672>.</span>prod()<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>        vol <span style=color:#f92672>=</span> port_series[<span style=color:#e6db74>&#34;rets&#34;</span>]<span style=color:#f92672>.</span>std()<span style=color:#f92672>*</span>np<span style=color:#f92672>.</span>sqrt(<span style=color:#ae81ff>252</span>)
</span></span><span style=display:flex><span>        sr <span style=color:#f92672>=</span> port_series[<span style=color:#e6db74>&#34;rets&#34;</span>]<span style=color:#f92672>.</span>mean()<span style=color:#f92672>/</span>port_series[<span style=color:#e6db74>&#34;rets&#34;</span>]<span style=color:#f92672>.</span>std()<span style=color:#f92672>*</span>np<span style=color:#f92672>.</span>sqrt(<span style=color:#ae81ff>252</span>)
</span></span><span style=display:flex><span>        metrics<span style=color:#f92672>.</span>append({<span style=color:#e6db74>&#34;period&#34;</span>: label, <span style=color:#e6db74>&#34;CumReturn&#34;</span>: cum, <span style=color:#e6db74>&#34;Volatility&#34;</span>: vol, <span style=color:#e6db74>&#34;Sharpe&#34;</span>: sr})
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    final_df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>concat(all_returns, axis<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>reset_index(drop<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>    final_df<span style=color:#f92672>.</span>to_csv(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;data/</span><span style=color:#e6db74>{</span>method<span style=color:#e6db74>}</span><span style=color:#e6db74>/raw_returns.csv&#34;</span>, index<span style=color:#f92672>=</span><span style=color:#66d9ef>False</span>)
</span></span><span style=display:flex><span>    pd<span style=color:#f92672>.</span>DataFrame(metrics)<span style=color:#f92672>.</span>set_index(<span style=color:#e6db74>&#34;period&#34;</span>)<span style=color:#f92672>.</span>to_csv(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;data/</span><span style=color:#e6db74>{</span>method<span style=color:#e6db74>}</span><span style=color:#e6db74>/metrics.csv&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>with</span> open(<span style=color:#e6db74>f</span><span style=color:#e6db74>&#34;data/</span><span style=color:#e6db74>{</span>method<span style=color:#e6db74>}</span><span style=color:#e6db74>/portfolios.json&#34;</span>, <span style=color:#e6db74>&#34;w&#34;</span>) <span style=color:#66d9ef>as</span> f:
</span></span><span style=display:flex><span>        json<span style=color:#f92672>.</span>dump(portfolios, f, indent<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>)
</span></span></code></pre></td></tr></table></div></div><p>Ngoài ra, InfoMap có hiệu suất tốt hơn trong trường hợp này. Louvain thường có xu hướng gom các nhóm lại thành <strong>cộng đồng lớn</strong>, do thuật toán ưu tiên tối đa hóa modularity – một đại lượng có thể bị &ldquo;bẫy tối ưu cục bộ&rdquo;, dẫn đến cộng đồng bị trộn lẫn (ví dụ: nhóm cổ phiếu ngân hàng có thể bị gom chung với cổ phiếu tài chính hoặc bảo hiểm). Trong khi đó, Infomap, nhờ đặc tính tối ưu “entropy”, thường <strong>tách rời</strong> được các nhóm hoạt động chặt chẽ hơn, như nhóm &ldquo;thép&rdquo;, &ldquo;ngân hàng&rdquo;, hay &ldquo;bán lẻ - công nghệ&rdquo; mà không bị pha tạp.</p><p>Ngoài ra, còn rất nhiều thuật toán community detection khác như : Walktrap, Clique Percolation Method, Leiden,.. mà bạn đọc có thể thử nghiệm.</p><table><thead><tr><th style=text-align:left><strong>Thuật toán</strong></th><th style=text-align:left><strong>Tối ưu tiêu chí</strong></th><th style=text-align:left><strong>Cách tiếp cận</strong></th><th style=text-align:left><strong>Ưu điểm</strong></th><th style=text-align:left><strong>Nhược điểm</strong></th></tr></thead><tbody><tr><td style=text-align:left><strong>Louvain</strong></td><td style=text-align:left>Modularity Q</td><td style=text-align:left>Heuristic</td><td style=text-align:left>Rất nhanh, hiệu quả, có thể áp dụng cho mạng lớn</td><td style=text-align:left>Có thể mắc kẹt ở tối ưu cục bộ, khó phát hiện cộng đồng nhỏ hoặc chồng lấn</td></tr><tr><td style=text-align:left><strong>Infomap</strong></td><td style=text-align:left>Entropy (Description Length)</td><td style=text-align:left>Random Walk</td><td style=text-align:left>Phân biệt tốt các cộng đồng nhỏ và chồng lấn, cho kết quả sắc nét hơn</td><td style=text-align:left>Chạy chậm hơn Louvain, nhạy cảm với cấu trúc mạng và ngẫu nhiên hóa</td></tr></tbody></table><h3 id=conclusion>Conclusion<a hidden class=anchor aria-hidden=true href=#conclusion>#</a></h3><p>Nghiên cứu này thử nghiệm việc áp dụng network theory và community detection trong thị trường chứng khoán Việt Nam (VN100). Kết quả cho thấy:</p><ul><li>Phương pháp phát hiện cộng đồng có thể giúp hiểu rõ hơn về cấu trúc thị trường và mối quan hệ giữa các cổ phiếu</li><li>Chiến lược đầu tư dựa trên InfoMap cho kết quả vượt trội hơn so với Louvain và VNINDEX về mặt Sharpe ratio và lợi nhuận</li><li>Tuy nhiên, các chiến lược này cũng đi kèm với rủi ro cao hơn thể hiện qua biến động và drawdown lớn hơn</li></ul><p>Nghiên cứu này mở ra hướng phát triển tiếp theo bằng cách:</p><ul><li>Thử nghiệm các thuật toán phát hiện cộng đồng khác</li><li>Áp dụng các phương pháp tối ưu hóa danh mục đầu tư thay vì phân bổ đều</li><li>Kết hợp với các chỉ báo kỹ thuật khác để cải thiện hiệu suất</li></ul><p>Cuối cùng, phương pháp này có thể được sử dụng như một công cụ hỗ trợ trong việc ra quyết định đầu tư, không nên được sử dụng một cách độc lập mà nên kết hợp với các phương pháp phân tích khác.</p><h3 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h3><p>[1] <a href=https://arxiv.org/pdf/2112.13383>https://arxiv.org/pdf/2112.13383</a><br>[2] <a href=https://gmarti.gitlab.io/networks/2018/06/03/pmfg-algorithm.html>https://gmarti.gitlab.io/networks/2018/06/03/pmfg-algorithm.html</a><br>[3] <a href=https://www.statworx.com/en/content-hub/blog/community-detection-with-louvain-and-infomap>https://www.statworx.com/en/content-hub/blog/community-detection-with-louvain-and-infomap</a><br>[4] ChatGPT o3 :)</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=prev href=http://localhost:1313/posts/2025/2025-06-23-graph-visibility-regime-and-risk-management/><span class=title>« Bài mới hơn</span><br><span>Graph visibility for regime detection and risk management</span>
</a><a class=next href=http://localhost:1313/posts/2025/2025-03-24-tsmom-vietnam/><span class=title>Bài cũ hơn »</span><br><span>Time series momentum - A traditional approach</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Community detection for VN100 on x" href="https://x.com/intent/tweet/?text=Community%20detection%20for%20VN100&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-05-17-stock-market-network%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Community detection for VN100 on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-05-17-stock-market-network%2f&amp;title=Community%20detection%20for%20VN100&amp;summary=Community%20detection%20for%20VN100&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-05-17-stock-market-network%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Community detection for VN100 on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-05-17-stock-market-network%2f&title=Community%20detection%20for%20VN100"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Community detection for VN100 on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-05-17-stock-market-network%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Community detection for VN100 on whatsapp" href="https://api.whatsapp.com/send?text=Community%20detection%20for%20VN100%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-05-17-stock-market-network%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Community detection for VN100 on telegram" href="https://telegram.me/share/url?text=Community%20detection%20for%20VN100&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-05-17-stock-market-network%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Community detection for VN100 on ycombinator" href="https://news.ycombinator.com/submitlink?t=Community%20detection%20for%20VN100&u=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-05-17-stock-market-network%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>The Financial Engineer</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Sao chép";function s(){t.innerHTML="Đã sao chép!",setTimeout(()=>{t.innerHTML="Sao chép"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>