<!doctype html><html lang=vi dir=auto><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Graph visibility for regime detection and risk management | The Financial Engineer</title>
<meta name=keywords content><meta name=description content="Thử nghiệm graph visibility cho xác định regime và cơ chế quản trị rủi ro"><meta name=author content><link rel=canonical href=http://localhost:1313/posts/2025/2025-06-23-graph-visibility-regime-and-risk-management/><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=http://localhost:1313/favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon-32x32.png><link rel=apple-touch-icon href=http://localhost:1313/apple-touch-icon.png><link rel=mask-icon href=http://localhost:1313/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=vi href=http://localhost:1313/posts/2025/2025-06-23-graph-visibility-regime-and-risk-management/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css integrity=sha384-MlJdn/WNKDGXveldHDdyRP1R4CTHr3FeuDNfhsLPYrq2t0UBkUdK2jyTnXPEK1NQ crossorigin=anonymous referrerpolicy=no-referrer><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js integrity=sha384-VQ8d8WVFw0yHhCk5E8I86oOhv48xLpnDZx5T9GogA/Y84DcCKWXDmSDfn13bzFZY crossorigin=anonymous referrerpolicy=no-referrer type=text/javascript></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous referrerpolicy=no-referrer type=text/javascript></script><script type=text/javascript>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"\\[",right:"\\]",display:!0},{left:"$",right:"$",display:!1},{left:"\\(",right:"\\)",display:!1}]})})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-BEV31LZP2J"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BEV31LZP2J")}</script><meta property="og:title" content="Graph visibility for regime detection and risk management"><meta property="og:description" content="Thử nghiệm graph visibility cho xác định regime và cơ chế quản trị rủi ro"><meta property="og:type" content="article"><meta property="og:url" content="http://localhost:1313/posts/2025/2025-06-23-graph-visibility-regime-and-risk-management/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-06-22T00:00:00+00:00"><meta property="article:modified_time" content="2025-06-22T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Graph visibility for regime detection and risk management"><meta name=twitter:description content="Thử nghiệm graph visibility cho xác định regime và cơ chế quản trị rủi ro"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Graph visibility for regime detection and risk management","item":"http://localhost:1313/posts/2025/2025-06-23-graph-visibility-regime-and-risk-management/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Graph visibility for regime detection and risk management","name":"Graph visibility for regime detection and risk management","description":"Thử nghiệm graph visibility cho xác định regime và cơ chế quản trị rủi ro","keywords":[],"articleBody":" Để lấy file code và dữ liệu, vui lòng gửi email tới hung.ha@miquant.vn\nConcept Trong thị trường tài chính đầy biến động, mỗi điểm dữ liệu không chỉ chứa giá trị tức thời mà còn ẩn chứa các mối liên hệ ngầm hình thành từ quy luật biến động theo thời gian. Các mô hình thống kê chuỗi thời gian (time series) truyền thống—với giả định tuyến tính và tính dừng— khó phát hiện chuyển đổi giữa các “regime” với nhau hay các phụ thuộc phi tuyến tính (non-linear) ẩn sâu trong dữ liệu chuỗi thời gian. Nhằm khắc phục những vấn đề này, Visibility Graph được phát triển, chuyển bài toán phân tích chuỗi thời gian (time series) thành phân tích mạng (network), từ đó tận dụng các công cụ của khoa học mạng (network science) để khai thác thông tin động lực và cấu trúc tiềm ẩn.\nTime Series to Visibility Graph? Time series Chuỗi thời gian là một dãy các điểm dữ liệu được liệt kê theo thứ tự thời gian, thường được thu thập tại các khoảng thời gian đều nhau. Nói cách khác, chuỗi thời gian là bất kỳ dãy dữ liệu nào được lấy ở các thời điểm rời rạc (discrete). Chuỗi thời gian thường được trực quan hóa bằng đồ thị đường, đồ thị diện tích hoặc đồ thị cột, trong đó trục hoành (x) tương ứng với thời gian, còn chiều cao (trục tung, y) tương ứng với giá trị dữ liệu tại thời điểm đó.\nMặc dù biểu đồ đường, diện tích hay cột cho ta cái nhìn tổng quan về xu hướng và biến động, nhưng rất khó để nhận diện:\nCác mối liên kết phi tuyến giữa hai điểm thời gian không kề nhau Những motif (pattern) lặp lại hay sự tự tương quan có thể tới từ những khoảng cách lớn trong dữ liệu Điểm gãy (change point) tiềm ẩn khi cấu trúc phụ thuộc giữa các giá thay đổi đột ngột Hay các trạng thái khác nhau của những giai đoạn thời gian khác nhau. Chính vì những khó khăn này của phương pháp pháp chuỗi thời gian, trong 2 thập kỷ trở lại đây, các nhà nghiên cứu bắt đầu chuyển hướng sang việc sử dụng các phương pháp “complex network” để mô tả các thông tin đầy biến động và phụ thuộc lẫn nhau của time series! Các phương pháp có thể kể đến như: proximity networks, transition networks, and visibility graphs. Bài viết sẽ tiến hành thử nghiệm với visibility graph.\nVisibility graph Visibility graph ra đời vào năm 2008, trong đó các nút (node) tương ứng với các điểm dữ liệu của chuỗi thời gian, và cạnh (edge) được nối giữa hai nút nếu chúng “nhìn thấy” nhau. Thuật toán này có thể ánh xạ mọi loại chuỗi thời gian thành mạng: chuyển chuỗi tuần hoàn thành đồ thị đều, chuỗi ngẫu nhiên thành đồ thị ngẫu nhiên và dễ dàng scale với mọi độ lớn của dữ liệu. Ngoài ra, có nhiều cách xây dựng visibility graph như: natural, horizontal và limited penetrable visibility graph. Bài viết thử nghiệm với natural visibility graph và mọi thử nghiệm luôn ngầm định là natural.\nViệc xây dựng visibility graph rất dễ, hai điểm dữ liệu được nối với nhau khi và chỉ khi đường thẳng nối chúng không bị bất kỳ điểm nào nằm giữa “che khuất” – tức là mọi giá trị tại các điểm giữa đều nằm dưới đường thẳng đó.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 from ts2vg import NaturalVG import networkx as nx import numpy as np import matplotlib.pyplot as plt # 1. Generate random time series (Brownian motion) rng = np.random.default_rng(110) ts = rng.standard_normal(size=8) ts = np.cumsum(ts) # 2. Build visibility graph g = NaturalVG(directed=None).build(ts) nxg = g.as_networkx() # 3. Make plots fig, [ax0, ax1, ax2] = plt.subplots(ncols=3, figsize=(12, 3.5),dpi=200) ax0.plot(ts) ax0.set_title(\"Time Series\") ## bar plot for time series ax0.bar(range(len(ts)), ts, color='lightblue', alpha=0.7) ax0.set_xlabel(\"Time\") # ax0.set_ylabel(\"Value\") ax0.set_title(\"Time Series Bar Plot\") graph_plot_options = { \"with_labels\": False, \"node_size\": 2, \"node_color\": [(0, 0, 0, 1)], \"edge_color\": [(0, 0, 0, 0.15)], } nx.draw_networkx(nxg, ax=ax1, pos=g.node_positions(), **graph_plot_options) ax1.tick_params(bottom=True, labelbottom=True) ax1.plot(ts) ax1.set_title(\"Visibility Graph\") ## adding bar plot for visibility graph ax1.bar(range(len(ts)), ts, color='lightblue', alpha=0.7) ax1.set_xlabel(\"Time\") # ax1.set_ylabel(\"Value\") nx.draw_networkx(nxg, ax=ax2, pos=nx.kamada_kawai_layout(nxg), **graph_plot_options) ax2.set_title(\"Visibility Graph\") # ax2.tick_params(bottom=True, labelbottom=True) ax2.set_xlabel('Graph') Về mặt toán học, phương trình xây dựng mô hình sẽ như sau.\nQuan sát dữ liệu, ta dễ dàng nhận thấy một hiện tượng thú vị: các điểm giá có xu hướng tự gom thành các cụm. Trong bài viết trước, chúng ta đã giới thiệu phương pháp xây dựng mạng và phân cộng đồng (community detection) để nhóm các nút tương đồng (link). Ở đây, phương pháp đó sẽ tiếp tục được áp dụng nhằm phân nhóm các ngày dựa trên mức độ tương đồng trong biến động giá, từ đó giúp xác định các “regime” khác nhau của chuỗi thời gian giá cổ phiếu. Ngoài ra, bài viết cũng thử nghiệm trích xuất thông tin “alternative” từ dữ liệu mạng như là chỉ báo để quản trị rủi ro cho tiến lược đầu tư.\nExperiment: Regime analysis \u0026 Risk management indicator Regime detection Trước tiên, chúng tiến hành thử nghiệm để đi tìm kiếm các trạng thái “regime” của cổ phiếu và VNINDEX. Để làm được điều đó, chúng ta sử dụng thuật toán natural visibility để xây dựng network, sau đó áp dụng thuật toán Louvain để xác định cộng đồng (community).\nSơ lược về bài toán regime detection, đây có thể xem như một dạng học không giám sát (unsupervised learning), trong đó mục tiêu là tự động phân nhóm các khoảng thời gian trong chuỗi giá dựa trên đặc trưng thống kê hoặc cấu trúc động lực. Mỗi regime tương ứng với một trạng thái thị trường khác nhau—chẳng hạn giai đoạn biến động thấp, biến động cao hay khủng hoảng—và không cần nhãn trước. Việc phát hiện chính xác các regime giúp tối ưu hóa chiến lược giao dịch, thiết lập bộ lọc rủi ro và hiểu rõ hơn về cấu trúc động lực của thị trường. Việc gom nhóm sẽ được xác định bằng thuật toán Louvain.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 def graph_visibility_construction(df): \"\"\" Construct a Natural Visibility Graph from a price series and detect communities. \"\"\" symbol = df.columns[0] ts = df[symbol].values dates = df.index # Build visibility graph vg = NaturalVG(directed=None) g = vg.build(ts) nxg = g.as_networkx() # nxg = g.as_igraph() ## We can also use igraph if needed # Detect Louvain communities communities = nx.algorithms.community.louvain_communities(nxg) # communities = nxg.community_infomap() ## Using Infomap for community detection # Assign colors COLORS = [\"#4C72B0\", \"#DD8452\", \"#55A868\", \"#C44E52\", \"#8172B3\", \"#937860\", \"#DA8BC3\", \"#CCB974\", \"#64B5CD\", \"#E24A33\", \"#8C72B0\", \"#FFB347\", \"#6BA368\", \"#D9534F\", \"#7E57C2\", \"#A1887F\", \"#E18ECF\", \"#C7C05D\", \"#4FAFBD\", \"#F28E2B\"] node_colors = [\"#000000\"] * len(ts) for cid, nodes in enumerate(communities): for n in nodes: node_colors[n] = COLORS[cid % len(COLORS)] return { 'symbol': symbol, 'ts': ts, 'dates': dates, 'nxg': nxg, 'vg': vg, 'communities': communities, 'node_colors': node_colors } Ta thu được kết quả như sau, thử nghiệm với FPT, HPG và VNINDEX\nChuyển đổi ngược trở lại thành time series thì sẽ trông như sau\nPhương pháp bắt tương đối chuẩn các thay đổi của giá cổ phiếu FPT. Với VNINDEX, việc xác định regime cũng tương đối chính xác và ta có thể nhận thấy Regime thứ 7 xuất hiện 3 lần. Việc xác định regime về mặt cảm quan là tương đối chính xác, tuy nhiên để thực sự đưa được regime này vào trong chiến lược đầu tư thì sẽ cần nhiều tính toán chi tiết hơn như: các thông tin mô tả mạng như (average shortest path, diameter, density, clustering coefficient,…). Viết phát triển tiếp tục mô hình regime detection này sẽ được nhường lại cho bạn đọc, hì!\nRisk management indicator Một trong những ứng dụng khác của mô hình này là xây dựng các chỉ báo nhằm phục vụ cho việc quản trị rủi ro. Bài viết sử dụng 2 chỉ báo\nDiameter: Trong graph theory, diameter là độ dài lớn nhất trong tất cả các quảng đường ngắn nhất giữa 2 node trong network. Nôm na có thể tưởng tượng là tìm ra tuyến đường ngắn nhất giữa mọi cặp thành phố có thể có trên bản đồ, sau đó chọn tuyến đường dài nhất trong số các tuyến đường ngắn nhất đó – đó chính là diamter. Diameter lớn cho thấy thị trường kém kết nối hơn, khi đó thông tin sẽ cần nhiều bước trung gian hơn để lan truyền. Điều này có thể báo hiệu rủi ro tăng, bởi thị trường đang phân mảnh.\nBetweenness Centrality Variance: Betweenness centrality đo tần suất một node nằm trên đường đi đường ngắn nhất (shortest path) giữa các node khác. Betweenness centrality có nghĩa là node có ảnh hưởng rất lớn. Bằng cách lấy phương sai của các giá trị này, ta đánh giá sự phân tán của mức độ ảnh hưởng: Khi variance cao cảnh báo rằng chỉ một vài node giữ phần lớn vai trò kết nối – khi những điểm này biến động, toàn bộ cấu trúc mạng dễ bị tác động mạnh. Từ đó biến động lớn của betweenness variance chính là tín hiệu cảnh báo rủi ro tập trung, giúp ta phát hiện sớm các turning point và giảm tỷ trọng vị thế kịp thời.\nTừ đó, việc sử dụng 2 chỉ báo này như một công cụ quản lý rủi ro nhằm đánh giá mức độ rủi ro của cổ phiếu. Bài viết sẽ thiết kế một hàm “activation” như là một công tắc để giảm hoặc bán hết danh mục khi thị trường vượt một mức rủi ro nhất định diễn tả thông qua 2 chỉ báo trên. Công cụ này sẽ được kết hợp với chiến lược TSMOM (đọc tại đây) như là công cụ quản lý rủi ro cho chiến lược này.\nXây dựng chỉ báo\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 def rolling_graph_features(prices: pd.Series, window: int = 60): \"\"\" Daily rolling visibility-graph features: - diameter (on largest component) - betw_var (variance of betweenness centrality) \"\"\" dates = prices.index[window:] vg = NaturalVG(directed=None) data = {'diameter': [], 'betw_var': []} for dt in dates: vals = prices.loc[:dt].iloc[-window:].values G = vg.build(vals).as_networkx() # diameter if nx.is_connected(G): d = nx.diameter(G) else: comp = max(nx.connected_components(G), key=len) d = nx.diameter(G.subgraph(comp)) data['diameter'].append(d) # betweenness variance bc = np.array(list(nx.betweenness_centrality(G).values())) data['betw_var'].append(bc.var()) return pd.DataFrame(data, index=dates) Tích hợp công cụ quản trị rủi ro cho chiến lược.\nChiến lược TSMOM cơ bản:\n$$ r_{t,t+1}^{TSMOM} =\\text{signal} *\\text{position} *\\text{return} - \\text{cost}= sign(r_{t-6, t})*\\frac{0.4}{\\sigma_t}*r_{t,t+1} - \\text{cost} $$Chiến lược TSMOM có cơ chế quản trị rủi ro\nTrong đó hệ số cảnh báo đồ thị $s_t$ được định nghĩa theo từng đoạn với các ngưỡng $z_{\\rm th}=1.645$, $z_{\\max}=2.576$ và có giả trị tối thiểu là $s_{\\min}$, $z_t^D , z_t^B$ là chỉ báo Dimater và Betweenness Centrality Variance được normalize.\n$$ s_t = \\begin{cases} 1, \u0026 z_t \\le z_{\\rm th},\\\\[6pt] 1 - \\dfrac{z_t - z_{\\rm th}}{\\,z_{\\max}-z_{\\rm th}\\,}\\,(1 - s_{\\min}), \u0026 z_{\\rm th} \u003c z_t \u003c z_{\\max},\\\\[8pt] s_{\\min}, \u0026 z_t \\ge z_{\\max}, \\end{cases} \\quad z_t = \\max\\{0,\\;z^D_t,\\;z^B_t\\}. $$Ngoài ra lấy max để\nQuan tâm kịch bản xấu nhất: bằng cách lấy giá trị lớn nhất, bạn để chỉ báo nào (Diamater hay Betweenness centrality variance) “cực đoan” hơn sẽ chi phối tín hiệu rủi ro. Tính đơn điệu (monocity): nếu một trong hai chỉ báo trở nên rủi ro hơn, $z_t$ chỉ tăng (không bao giờ giảm), đảm bảo bạn không bao giờ đánh giá thấp mức độ rủi ro. Ngoài ra, hàm quản trị rủi ro chỉ được kích hoạt khi các chỉ báo vượt trên mức 90% và giảm vị thế tối thiểu khi chỉ báo vượt mức 99%.\nDưới 90% → diễn biến còn trong vùng “bình thường” → giữ nguyên vị thế. Trên 90% → bắt đầu “penalize” dần, càng lên tới 99% càng giảm mạnh. Trên 99% → khẩn cấp → giảm ngay về mức tối thiểu. Giữa 90–99%, nội suy tuyến tính từ 1 → mức tối thiểu Kết quả là một chỉ báo động: giữ nguyên khi thị trường bình thường, giảm dần khi căng thẳng tăng, và “giảm tối đa” khi cực đoan—tất cả dựa trên những mức cắt 90% và 99% quen thuộc trong quản trị rủi ro.\n1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 # === graph early-warning scaling === # (a) daily graph features → weekly gf_daily = rolling_graph_features(prices, window=graph_window) gf_weekly = (gf_daily .resample('W-FRI').last() .reindex(weekly_ret.index, method='ffill')) # (b) compute threshold flags alpha = 2.0 / (warn_lookback_weeks + 1) mu_diam = gf_weekly['diameter'].ewm(alpha=alpha, min_periods=warn_lookback_weeks//2).mean() sd_diam = gf_weekly['diameter'].ewm(alpha=alpha, min_periods=warn_lookback_weeks//2).std() mu_betw = gf_weekly['betw_var'].ewm(alpha=alpha, min_periods=warn_lookback_weeks//2).mean() sd_betw = gf_weekly['betw_var'].ewm(alpha=alpha, min_periods=warn_lookback_weeks//2).std() z_diam = (gf_weekly['diameter'] - mu_diam) / sd_diam z_betw = (gf_weekly['betw_var'] - mu_betw) / sd_betw z_spike = pd.concat([z_diam, z_betw], axis=1).clip(lower=0).max(axis=1) # assume z_spike is a pd.Series of your max‐z scores z_th = 1.645 z_max = 2.576 # piecewise linear # a) between z_th and z_max, linearly ramp down ramp = 1 - ((z_spike - z_th) / (z_max - z_th)) * (1 - s_min) # b) combine into one Series risk_scale = pd.Series(1.0, index=z_spike.index) # when above threshold, use ramp but cap at s_min mask = z_spike \u003e z_th risk_scale[mask] = ramp[mask].clip(lower=s_min) position_warn = signal * pos_size * risk_scale trade_cost_warn = 2 * commission * pd.Series(position_warn).diff().abs().shift(-1) strat_ret_warn = position_warn * weekly_ret.shift(-1) - trade_cost_warn Kết quả thu được như sau cho cổ phiếu HPG\nMetric Buy \u0026 Hold TSMOM Traditional TSMOM + Graph Warning Total Return 656.45% 852.83% 1000.08% Annualized Return 24.51% 27.66% 29.66% Annualized Volatility 33.91% 29.95% 29.14% Sharpe Ratio 0.82 0.97 1.04 Sortino Ratio 1.28 1.56 1.74 Max Drawdown –71.62% –41.70% –41.70% 95% VaR –6.59% –5.31% –5.24% Kết quả cho cổ phiếu HPG cho thấy:\nSo với TSMOM truyền thống, việc thêm hệ số cảnh báo đồ thị giúp tăng lợi nhuận trung bình thêm 2% (từ 27.66% lên 29.66%) trong khi giảm nhẹ độ biến động (từ 29.95% xuống 29.14%) từ đó Sharpe Ratio được đẩy lên từ 0.97 lên 1.04. Một mức tối ưu ổn 🙂 tuy nhiên không phải là xuất sắc khi max drawdown vẫn giữ nguyên. Điều này có thể đến từ việc sử dụng dữ liệu hoặc thiết kế của công cụ quản trị rủi ro chưa bắt được đúng những pha giảm mạnh của thị trường. Việc tối ưu hoặc xây dựng một cơ chế đo lường rủi ro khác có thể được dễ dàng thực hiện cho bạn đọc.\nTuy nhiên, việc tách bạch cơ chế giữa chiến lược mua/bán cổ phiếu với cơ chế quản trị rủi ro có thể giúp trader dễ dàng cân chỉnh được phần hiệu suất của chiến lược hay cơ chế quản trị rủi ro từ đó giúp cho hệ thống minh bạch, dễ kiểm soát và đáng tin hơn.\nKết luận Visibility Graph mở ra một lăng kính mới trong phân tích chuỗi thời gian tài chính, giúp chuyển hóa những quy luật ẩn sâu trong chuyển động giá thành cấu trúc mạng có thể khai thác bằng các công cụ của network science. Thay vì chỉ dựa vào giả định tuyến tính và tính dừng của mô hình thống kê truyền thống, phương pháp này tận dụng được các phụ thuộc phi tuyến và khả năng nhận diện các “regime” thị trường thông qua phân cộng đồng. Việc áp dụng Natural Visibility Graph cùng thuật toán Louvain không chỉ cho phép phát hiện trực quan các giai đoạn của giá cổ phiếu nói riêng và time series nói chung mà còn cung cấp nền tảng để xây dựng các chỉ báo quản trị rủi ro dựa trên cấu trúc mạng.\nNgoài ra, phương pháp này cũng là một cách tiếp cận đầy tiềm năng trong việc xây dựng các công cụ quản trị rủi ro thông qua khai thác thêm các đặc trưng mạng để xác định các giai đoạn stress của thị trường, rủi ro phân mảnh của cổ phiếu hay chuyển đổi regime để từ đó tích hợp vào trong từng chiến lược đầu tư.\nTóm lại, visibility graph không chỉ là công cụ hỗ trợ phân tích chuỗi thời gian mà còn là nền tảng để xây dựng các chỉ báo rủi ro mang tính cấu trúc và động lực. Việc tiếp tục khai thác các đặc trưng mạng chuyên sâu và tinh chỉnh cơ chế kích hoạt sẽ giúp hoàn thiện mô hình, đồng thời đem lại lợi thế cạnh tranh trong quản trị rủi ro và tối ưu hóa chiến lược đầu tư.\nReference [1] https://cbergillos.com/ts2vg/examples.html\n[2] https://www.cs.cornell.edu/home/kleinber/networks-book/\n[3] https://onlinelibrary.wiley.com/doi/epdf/10.1155/2019/5320686\n[4] https://vnquant.vn/posts/2025/2025-05-17-stock-market-network/\n[5] https://vnquant.vn/posts/2025/2025-03-24-tsmom-vietnam/\n[6] https://arxiv.org/abs/0810.0920\n","wordCount":"2893","inLanguage":"vi","datePublished":"2025-06-22T00:00:00Z","dateModified":"2025-06-22T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:1313/posts/2025/2025-06-23-graph-visibility-regime-and-risk-management/"},"publisher":{"@type":"Organization","name":"The Financial Engineer","logo":{"@type":"ImageObject","url":"http://localhost:1313/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=http://localhost:1313/ accesskey=h title="The Financial Engineer (Alt + H)">The Financial Engineer</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=http://localhost:1313/about/ title=About><span>About</span></a></li><li><a href=http://localhost:1313/archives/ title=Archive><span>Archive</span></a></li><li><a href=http://localhost:1313/tags/ title=Tags><span>Tags</span></a></li><li><a href=http://localhost:1313/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class="post-title entry-hint-parent">Graph visibility for regime detection and risk management</h1><div class=post-description>Thử nghiệm graph visibility cho xác định regime và cơ chế quản trị rủi ro</div><div class=post-meta><span title='2025-06-22 00:00:00 +0000 UTC'>tháng 6 22, 2025</span>&nbsp;·&nbsp;14 phút</div></header><div class=toc><details open><summary accesskey=c title="(Alt + C)"><span class=details>Mục lục</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#concept>Concept</a></li><li><a href=#time-series-to-visibility-graph>Time Series to Visibility Graph?</a><ul><li><a href=#time-series>Time series</a></li><li><a href=#visibility-graph>Visibility graph</a></li></ul></li><li><a href=#experiment-regime-analysis--risk-management-indicator>Experiment: Regime analysis & Risk management indicator</a><ul><li><a href=#regime-detection>Regime detection</a></li><li><a href=#risk-management-indicator>Risk management indicator</a></li></ul></li><li><a href=#kết-luận>Kết luận</a></li><li><a href=#reference>Reference</a></li></ul></nav></div></details></div><div class=post-content><p><img loading=lazy src=images/cover.png alt=cover>
Để lấy file code và dữ liệu, vui lòng gửi email tới <a href=mailto:hung.ha@miquant.vn>hung.ha@miquant.vn</a></p><h2 id=concept>Concept<a hidden class=anchor aria-hidden=true href=#concept>#</a></h2><p>Trong thị trường tài chính đầy biến động, mỗi điểm dữ liệu không chỉ chứa giá trị tức thời mà còn ẩn chứa các mối liên hệ ngầm hình thành từ quy luật biến động theo thời gian. Các mô hình thống kê chuỗi thời gian (time series) truyền thống—với giả định tuyến tính và tính dừng— khó phát hiện chuyển đổi giữa các “regime” với nhau hay các phụ thuộc phi tuyến tính (non-linear) ẩn sâu trong dữ liệu chuỗi thời gian. Nhằm khắc phục những vấn đề này, Visibility Graph được phát triển, chuyển bài toán phân tích chuỗi thời gian (time series) thành phân tích mạng (network), từ đó tận dụng các công cụ của khoa học mạng (network science) để khai thác thông tin động lực và cấu trúc tiềm ẩn.</p><h2 id=time-series-to-visibility-graph>Time Series to Visibility Graph?<a hidden class=anchor aria-hidden=true href=#time-series-to-visibility-graph>#</a></h2><h3 id=time-series>Time series<a hidden class=anchor aria-hidden=true href=#time-series>#</a></h3><p>Chuỗi thời gian là một dãy các điểm dữ liệu được liệt kê theo thứ tự thời gian, thường được thu thập tại các khoảng thời gian đều nhau. Nói cách khác, chuỗi thời gian là bất kỳ dãy dữ liệu nào được lấy ở các thời điểm rời rạc (discrete). Chuỗi thời gian thường được trực quan hóa bằng đồ thị đường, đồ thị diện tích hoặc đồ thị cột, trong đó trục hoành (x) tương ứng với thời gian, còn chiều cao (trục tung, y) tương ứng với giá trị dữ liệu tại thời điểm đó.</p><p><img loading=lazy src=images/1.png alt=image.png></p><p>Mặc dù biểu đồ đường, diện tích hay cột cho ta cái nhìn tổng quan về xu hướng và biến động, nhưng rất khó để nhận diện:</p><ul><li>Các mối liên kết phi tuyến giữa hai điểm thời gian không kề nhau</li><li>Những motif (pattern) lặp lại hay sự tự tương quan có thể tới từ những khoảng cách lớn trong dữ liệu</li><li>Điểm gãy (change point) tiềm ẩn khi cấu trúc phụ thuộc giữa các giá thay đổi đột ngột</li><li>Hay các trạng thái khác nhau của những giai đoạn thời gian khác nhau.</li></ul><p>Chính vì những khó khăn này của phương pháp pháp chuỗi thời gian, trong 2 thập kỷ trở lại đây, các nhà nghiên cứu bắt đầu chuyển hướng sang việc sử dụng các phương pháp “complex network” để mô tả các thông tin đầy biến động và phụ thuộc lẫn nhau của time series! Các phương pháp có thể kể đến như: proximity networks, transition networks, and
visibility graphs. Bài viết sẽ tiến hành thử nghiệm với visibility graph.</p><h3 id=visibility-graph>Visibility graph<a hidden class=anchor aria-hidden=true href=#visibility-graph>#</a></h3><p>Visibility graph ra đời vào năm 2008, trong đó các nút (node) tương ứng với các điểm dữ liệu của chuỗi thời gian, và cạnh (edge) được nối giữa hai nút nếu chúng “nhìn thấy” nhau. Thuật toán này có thể ánh xạ mọi loại chuỗi thời gian thành mạng: chuyển chuỗi tuần hoàn thành đồ thị đều, chuỗi ngẫu nhiên thành đồ thị ngẫu nhiên và dễ dàng scale với mọi độ lớn của dữ liệu. Ngoài ra, có nhiều cách xây dựng visibility graph như: natural, horizontal và limited penetrable visibility graph. Bài viết thử nghiệm với natural visibility graph và mọi thử nghiệm luôn ngầm định là natural.</p><p>Việc xây dựng visibility graph rất dễ, hai điểm dữ liệu được nối với nhau khi và chỉ khi đường thẳng nối chúng không bị bất kỳ điểm nào nằm giữa “che khuất” – tức là mọi giá trị tại các điểm giữa đều nằm dưới đường thẳng đó.</p><p><img loading=lazy src=images/2.png alt=image.png></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">46
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#f92672>from</span> ts2vg <span style=color:#f92672>import</span> NaturalVG
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> networkx <span style=color:#66d9ef>as</span> nx
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> numpy <span style=color:#66d9ef>as</span> np
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> matplotlib.pyplot <span style=color:#66d9ef>as</span> plt
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 1. Generate random time series (Brownian motion)</span>
</span></span><span style=display:flex><span>rng <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>random<span style=color:#f92672>.</span>default_rng(<span style=color:#ae81ff>110</span>)
</span></span><span style=display:flex><span>ts <span style=color:#f92672>=</span> rng<span style=color:#f92672>.</span>standard_normal(size<span style=color:#f92672>=</span><span style=color:#ae81ff>8</span>)
</span></span><span style=display:flex><span>ts <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>cumsum(ts)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 2. Build visibility graph</span>
</span></span><span style=display:flex><span>g <span style=color:#f92672>=</span> NaturalVG(directed<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>)<span style=color:#f92672>.</span>build(ts)
</span></span><span style=display:flex><span>nxg <span style=color:#f92672>=</span> g<span style=color:#f92672>.</span>as_networkx()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># 3. Make plots</span>
</span></span><span style=display:flex><span>fig, [ax0, ax1, ax2] <span style=color:#f92672>=</span> plt<span style=color:#f92672>.</span>subplots(ncols<span style=color:#f92672>=</span><span style=color:#ae81ff>3</span>, figsize<span style=color:#f92672>=</span>(<span style=color:#ae81ff>12</span>, <span style=color:#ae81ff>3.5</span>),dpi<span style=color:#f92672>=</span><span style=color:#ae81ff>200</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>ax0<span style=color:#f92672>.</span>plot(ts)
</span></span><span style=display:flex><span>ax0<span style=color:#f92672>.</span>set_title(<span style=color:#e6db74>&#34;Time Series&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>## bar plot for time series</span>
</span></span><span style=display:flex><span>ax0<span style=color:#f92672>.</span>bar(range(len(ts)), ts, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;lightblue&#39;</span>, alpha<span style=color:#f92672>=</span><span style=color:#ae81ff>0.7</span>)
</span></span><span style=display:flex><span>ax0<span style=color:#f92672>.</span>set_xlabel(<span style=color:#e6db74>&#34;Time&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># ax0.set_ylabel(&#34;Value&#34;)</span>
</span></span><span style=display:flex><span>ax0<span style=color:#f92672>.</span>set_title(<span style=color:#e6db74>&#34;Time Series Bar Plot&#34;</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>graph_plot_options <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;with_labels&#34;</span>: <span style=color:#66d9ef>False</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;node_size&#34;</span>: <span style=color:#ae81ff>2</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;node_color&#34;</span>: [(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>)],
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;edge_color&#34;</span>: [(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0.15</span>)],
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>nx<span style=color:#f92672>.</span>draw_networkx(nxg, ax<span style=color:#f92672>=</span>ax1, pos<span style=color:#f92672>=</span>g<span style=color:#f92672>.</span>node_positions(), <span style=color:#f92672>**</span>graph_plot_options)
</span></span><span style=display:flex><span>ax1<span style=color:#f92672>.</span>tick_params(bottom<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>, labelbottom<span style=color:#f92672>=</span><span style=color:#66d9ef>True</span>)
</span></span><span style=display:flex><span>ax1<span style=color:#f92672>.</span>plot(ts)
</span></span><span style=display:flex><span>ax1<span style=color:#f92672>.</span>set_title(<span style=color:#e6db74>&#34;Visibility Graph&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e>## adding bar plot for visibility graph</span>
</span></span><span style=display:flex><span>ax1<span style=color:#f92672>.</span>bar(range(len(ts)), ts, color<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;lightblue&#39;</span>, alpha<span style=color:#f92672>=</span><span style=color:#ae81ff>0.7</span>)
</span></span><span style=display:flex><span>ax1<span style=color:#f92672>.</span>set_xlabel(<span style=color:#e6db74>&#34;Time&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># ax1.set_ylabel(&#34;Value&#34;)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>nx<span style=color:#f92672>.</span>draw_networkx(nxg, ax<span style=color:#f92672>=</span>ax2, pos<span style=color:#f92672>=</span>nx<span style=color:#f92672>.</span>kamada_kawai_layout(nxg), <span style=color:#f92672>**</span>graph_plot_options)
</span></span><span style=display:flex><span>ax2<span style=color:#f92672>.</span>set_title(<span style=color:#e6db74>&#34;Visibility Graph&#34;</span>)
</span></span><span style=display:flex><span><span style=color:#75715e># ax2.tick_params(bottom=True, labelbottom=True)</span>
</span></span><span style=display:flex><span>ax2<span style=color:#f92672>.</span>set_xlabel(<span style=color:#e6db74>&#39;Graph&#39;</span>)
</span></span></code></pre></td></tr></table></div></div><p>Về mặt toán học, phương trình xây dựng mô hình sẽ như sau.</p><p><img loading=lazy src=images/equation_1.png alt=equation></p><p>Quan sát dữ liệu, ta dễ dàng nhận thấy một hiện tượng thú vị: các điểm giá có xu hướng tự gom thành các cụm. Trong bài viết trước, chúng ta đã giới thiệu phương pháp xây dựng mạng và phân cộng đồng (community detection) để nhóm các nút tương đồng (<a href=https://vnquant.vn/posts/2025/2025-05-17-stock-market-network/>link</a>). Ở đây, phương pháp đó sẽ tiếp tục được áp dụng nhằm phân nhóm các ngày dựa trên mức độ tương đồng trong biến động giá, từ đó giúp xác định các “regime” khác nhau của chuỗi thời gian giá cổ phiếu. Ngoài ra, bài viết cũng thử nghiệm trích xuất thông tin “alternative” từ dữ liệu mạng như là chỉ báo để quản trị rủi ro cho tiến lược đầu tư.</p><h2 id=experiment-regime-analysis--risk-management-indicator>Experiment: Regime analysis & Risk management indicator<a hidden class=anchor aria-hidden=true href=#experiment-regime-analysis--risk-management-indicator>#</a></h2><h3 id=regime-detection>Regime detection<a hidden class=anchor aria-hidden=true href=#regime-detection>#</a></h3><p>Trước tiên, chúng tiến hành thử nghiệm để đi tìm kiếm các trạng thái “regime” của cổ phiếu và VNINDEX. Để làm được điều đó, chúng ta sử dụng thuật toán natural visibility để xây dựng network, sau đó áp dụng thuật toán Louvain để xác định cộng đồng (community).</p><p>Sơ lược về bài toán regime detection, đây có thể xem như một dạng học không giám sát (unsupervised learning), trong đó mục tiêu là tự động phân nhóm các khoảng thời gian trong chuỗi giá dựa trên đặc trưng thống kê hoặc cấu trúc động lực. Mỗi regime tương ứng với một trạng thái thị trường khác nhau—chẳng hạn giai đoạn biến động thấp, biến động cao hay khủng hoảng—và không cần nhãn trước. Việc phát hiện chính xác các regime giúp tối ưu hóa chiến lược giao dịch, thiết lập bộ lọc rủi ro và hiểu rõ hơn về cấu trúc động lực của thị trường. Việc gom nhóm sẽ được xác định bằng thuật toán Louvain.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>graph_visibility_construction</span>(df):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Construct a Natural Visibility Graph from a price series and detect communities.
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    symbol <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>columns[<span style=color:#ae81ff>0</span>]
</span></span><span style=display:flex><span>    ts <span style=color:#f92672>=</span> df[symbol]<span style=color:#f92672>.</span>values
</span></span><span style=display:flex><span>    dates <span style=color:#f92672>=</span> df<span style=color:#f92672>.</span>index
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Build visibility graph</span>
</span></span><span style=display:flex><span>    vg <span style=color:#f92672>=</span> NaturalVG(directed<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>    g <span style=color:#f92672>=</span> vg<span style=color:#f92672>.</span>build(ts)
</span></span><span style=display:flex><span>    nxg <span style=color:#f92672>=</span> g<span style=color:#f92672>.</span>as_networkx()
</span></span><span style=display:flex><span>    <span style=color:#75715e># nxg = g.as_igraph() ## We can also use igraph if needed</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e># Detect Louvain communities</span>
</span></span><span style=display:flex><span>    communities <span style=color:#f92672>=</span> nx<span style=color:#f92672>.</span>algorithms<span style=color:#f92672>.</span>community<span style=color:#f92672>.</span>louvain_communities(nxg)
</span></span><span style=display:flex><span>    <span style=color:#75715e># communities = nxg.community_infomap() ## Using Infomap for community detection</span>
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e># Assign colors</span>
</span></span><span style=display:flex><span>    COLORS <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;#4C72B0&#34;</span>, <span style=color:#e6db74>&#34;#DD8452&#34;</span>, <span style=color:#e6db74>&#34;#55A868&#34;</span>, <span style=color:#e6db74>&#34;#C44E52&#34;</span>, <span style=color:#e6db74>&#34;#8172B3&#34;</span>, <span style=color:#e6db74>&#34;#937860&#34;</span>, <span style=color:#e6db74>&#34;#DA8BC3&#34;</span>, <span style=color:#e6db74>&#34;#CCB974&#34;</span>, <span style=color:#e6db74>&#34;#64B5CD&#34;</span>, <span style=color:#e6db74>&#34;#E24A33&#34;</span>, <span style=color:#e6db74>&#34;#8C72B0&#34;</span>, <span style=color:#e6db74>&#34;#FFB347&#34;</span>, <span style=color:#e6db74>&#34;#6BA368&#34;</span>, <span style=color:#e6db74>&#34;#D9534F&#34;</span>, <span style=color:#e6db74>&#34;#7E57C2&#34;</span>, <span style=color:#e6db74>&#34;#A1887F&#34;</span>, <span style=color:#e6db74>&#34;#E18ECF&#34;</span>, <span style=color:#e6db74>&#34;#C7C05D&#34;</span>, <span style=color:#e6db74>&#34;#4FAFBD&#34;</span>, <span style=color:#e6db74>&#34;#F28E2B&#34;</span>]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    node_colors <span style=color:#f92672>=</span> [<span style=color:#e6db74>&#34;#000000&#34;</span>] <span style=color:#f92672>*</span> len(ts)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> cid, nodes <span style=color:#f92672>in</span> enumerate(communities):
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> n <span style=color:#f92672>in</span> nodes:
</span></span><span style=display:flex><span>            node_colors[n] <span style=color:#f92672>=</span> COLORS[cid <span style=color:#f92672>%</span> len(COLORS)]
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;symbol&#39;</span>: symbol,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;ts&#39;</span>: ts,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;dates&#39;</span>: dates,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;nxg&#39;</span>: nxg,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;vg&#39;</span>: vg,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;communities&#39;</span>: communities,
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#39;node_colors&#39;</span>: node_colors
</span></span><span style=display:flex><span>    }
</span></span></code></pre></td></tr></table></div></div><p>Ta thu được kết quả như sau, thử nghiệm với FPT, HPG và VNINDEX</p><p><img loading=lazy src=images/3.png alt=FPT>
<img loading=lazy src=images/4.png alt=HPG>
<img loading=lazy src=images/5.png alt=VNINDEX>
Chuyển đổi ngược trở lại thành time series thì sẽ trông như sau</p><p><img loading=lazy src=images/6.png alt=FPT></p><p><img loading=lazy src=images/7.png alt=VNINDEX></p><p>Phương pháp bắt tương đối chuẩn các thay đổi của giá cổ phiếu FPT. Với VNINDEX, việc xác định regime cũng tương đối chính xác và ta có thể nhận thấy Regime thứ 7 xuất hiện 3 lần. Việc xác định regime về mặt cảm quan là tương đối chính xác, tuy nhiên để thực sự đưa được regime này vào trong chiến lược đầu tư thì sẽ cần nhiều tính toán chi tiết hơn như: các thông tin mô tả mạng như (average shortest path, diameter, density, clustering coefficient,…). Viết phát triển tiếp tục mô hình regime detection này sẽ được nhường lại cho bạn đọc, hì!</p><h3 id=risk-management-indicator>Risk management indicator<a hidden class=anchor aria-hidden=true href=#risk-management-indicator>#</a></h3><p>Một trong những ứng dụng khác của mô hình này là xây dựng các chỉ báo nhằm phục vụ cho việc quản trị rủi ro. Bài viết sử dụng 2 chỉ báo</p><p><strong>Diameter:</strong> Trong graph theory, diameter là độ dài lớn nhất trong tất cả các quảng đường ngắn nhất giữa 2 node trong network. Nôm na có thể tưởng tượng là tìm ra tuyến đường ngắn nhất giữa mọi cặp thành phố có thể có trên bản đồ, sau đó chọn tuyến đường dài nhất trong số các tuyến đường ngắn nhất đó – đó chính là diamter. Diameter lớn cho thấy thị trường kém kết nối hơn, khi đó thông tin sẽ cần nhiều bước trung gian hơn để lan truyền. Điều này có thể báo hiệu rủi ro tăng, bởi thị trường đang phân mảnh.</p><p><strong>Betweenness Centrality Variance</strong>: Betweenness centrality đo tần suất một node nằm trên đường đi đường ngắn nhất (shortest path) giữa các node khác. Betweenness centrality có nghĩa là node có ảnh hưởng rất lớn. Bằng cách lấy phương sai của các giá trị này, ta đánh giá sự phân tán của mức độ ảnh hưởng: Khi variance cao cảnh báo rằng chỉ một vài node giữ phần lớn vai trò kết nối – khi những điểm này biến động, toàn bộ cấu trúc mạng dễ bị tác động mạnh. Từ đó biến động lớn của betweenness variance chính là tín hiệu cảnh báo rủi ro tập trung, giúp ta phát hiện sớm các turning point và giảm tỷ trọng vị thế kịp thời.</p><p>Từ đó, việc sử dụng 2 chỉ báo này như một công cụ quản lý rủi ro nhằm đánh giá mức độ rủi ro của cổ phiếu. Bài viết sẽ thiết kế một hàm “activation” như là một công tắc để giảm hoặc bán hết danh mục khi thị trường vượt một mức rủi ro nhất định diễn tả thông qua 2 chỉ báo trên. Công cụ này sẽ được kết hợp với chiến lược TSMOM (<a href=https://vnquant.vn/posts/2025/2025-03-24-tsmom-vietnam/>đọc tại đây</a>) như là công cụ quản lý rủi ro cho chiến lược này.</p><p><strong>Xây dựng chỉ báo</strong></p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#66d9ef>def</span> <span style=color:#a6e22e>rolling_graph_features</span>(prices: pd<span style=color:#f92672>.</span>Series, window: int <span style=color:#f92672>=</span> <span style=color:#ae81ff>60</span>):
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;&#34;&#34;
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    Daily rolling visibility-graph features:
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - diameter (on largest component)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>      - betw_var (variance of betweenness centrality)
</span></span></span><span style=display:flex><span><span style=color:#e6db74>    &#34;&#34;&#34;</span>
</span></span><span style=display:flex><span>    dates <span style=color:#f92672>=</span> prices<span style=color:#f92672>.</span>index[window:]
</span></span><span style=display:flex><span>    vg <span style=color:#f92672>=</span> NaturalVG(directed<span style=color:#f92672>=</span><span style=color:#66d9ef>None</span>)
</span></span><span style=display:flex><span>    data <span style=color:#f92672>=</span> {<span style=color:#e6db74>&#39;diameter&#39;</span>: [], <span style=color:#e6db74>&#39;betw_var&#39;</span>: []}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> dt <span style=color:#f92672>in</span> dates:
</span></span><span style=display:flex><span>        vals <span style=color:#f92672>=</span> prices<span style=color:#f92672>.</span>loc[:dt]<span style=color:#f92672>.</span>iloc[<span style=color:#f92672>-</span>window:]<span style=color:#f92672>.</span>values
</span></span><span style=display:flex><span>        G <span style=color:#f92672>=</span> vg<span style=color:#f92672>.</span>build(vals)<span style=color:#f92672>.</span>as_networkx()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># diameter</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> nx<span style=color:#f92672>.</span>is_connected(G):
</span></span><span style=display:flex><span>            d <span style=color:#f92672>=</span> nx<span style=color:#f92672>.</span>diameter(G)
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>else</span>:
</span></span><span style=display:flex><span>            comp <span style=color:#f92672>=</span> max(nx<span style=color:#f92672>.</span>connected_components(G), key<span style=color:#f92672>=</span>len)
</span></span><span style=display:flex><span>            d <span style=color:#f92672>=</span> nx<span style=color:#f92672>.</span>diameter(G<span style=color:#f92672>.</span>subgraph(comp))
</span></span><span style=display:flex><span>        data[<span style=color:#e6db74>&#39;diameter&#39;</span>]<span style=color:#f92672>.</span>append(d)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e># betweenness variance</span>
</span></span><span style=display:flex><span>        bc <span style=color:#f92672>=</span> np<span style=color:#f92672>.</span>array(list(nx<span style=color:#f92672>.</span>betweenness_centrality(G)<span style=color:#f92672>.</span>values()))
</span></span><span style=display:flex><span>        data[<span style=color:#e6db74>&#39;betw_var&#39;</span>]<span style=color:#f92672>.</span>append(bc<span style=color:#f92672>.</span>var())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> pd<span style=color:#f92672>.</span>DataFrame(data, index<span style=color:#f92672>=</span>dates)
</span></span></code></pre></td></tr></table></div></div><p>Tích hợp công cụ quản trị rủi ro cho chiến lược.</p><p>Chiến lược TSMOM cơ bản:</p>$$
r_{t,t+1}^{TSMOM} =\text{signal} *\text{position} *\text{return} - \text{cost}= sign(r_{t-6, t})*\frac{0.4}{\sigma_t}*r_{t,t+1} - \text{cost}
$$<p>Chiến lược TSMOM có cơ chế quản trị rủi ro</p><p><img loading=lazy src=images/equation_2.png alt=equation></p><p>Trong đó hệ số cảnh báo đồ thị $s_t$ được định nghĩa theo từng đoạn với các ngưỡng $z_{\rm th}=1.645$, $z_{\max}=2.576$ và có giả trị tối thiểu là $s_{\min}$, $z_t^D , z_t^B$ là chỉ báo Dimater và Betweenness Centrality Variance được normalize.</p>$$
s_t =
\begin{cases}
1, & z_t \le z_{\rm th},\\[6pt]
1 - \dfrac{z_t - z_{\rm th}}{\,z_{\max}-z_{\rm th}\,}\,(1 - s_{\min}),
& z_{\rm th} < z_t < z_{\max},\\[8pt]
s_{\min}, & z_t \ge z_{\max},
\end{cases}
\quad
z_t = \max\{0,\;z^D_t,\;z^B_t\}.
$$<p>Ngoài ra lấy max để</p><ul><li><strong>Quan tâm kịch bản xấu nhất</strong>: bằng cách lấy giá trị lớn nhất, bạn để chỉ báo nào (Diamater hay Betweenness centrality variance) “cực đoan” hơn sẽ chi phối tín hiệu rủi ro.</li><li><strong>Tính đơn điệu (monocity)</strong>: nếu một trong hai chỉ báo trở nên rủi ro hơn, $z_t$ chỉ tăng (không bao giờ giảm), đảm bảo bạn không bao giờ đánh giá thấp mức độ rủi ro.</li></ul><p>Ngoài ra, hàm quản trị rủi ro chỉ được kích hoạt khi các chỉ báo vượt trên mức 90% và giảm vị thế tối thiểu khi chỉ báo vượt mức 99%.</p><ul><li>Dưới 90% → diễn biến còn trong vùng “bình thường” → giữ nguyên vị thế.</li><li>Trên 90% → bắt đầu “penalize” dần, càng lên tới 99% càng giảm mạnh.</li><li>Trên 99% → khẩn cấp → giảm ngay về mức tối thiểu.</li><li>Giữa 90–99%, nội suy tuyến tính từ 1 → mức tối thiểu</li></ul><p>Kết quả là một chỉ báo động: <strong>giữ nguyên khi thị trường bình thường, giảm dần khi căng thẳng tăng, và “giảm tối đa” khi cực đoan</strong>—tất cả dựa trên những mức cắt 90% và 99% quen thuộc trong quản trị rủi ro.</p><div class=highlight><div style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><table style=border-spacing:0;padding:0;margin:0;border:0><tr><td style=vertical-align:top;padding:0;margin:0;border:0><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f"> 9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:.4em;padding:0 .4em;color:#7f7f7f">38
</span></code></pre></td><td style=vertical-align:top;padding:0;margin:0;border:0;width:100%><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=display:flex><span><span style=color:#75715e># === graph early-warning scaling ===</span>
</span></span><span style=display:flex><span><span style=color:#75715e># (a) daily graph features → weekly</span>
</span></span><span style=display:flex><span>gf_daily  <span style=color:#f92672>=</span> rolling_graph_features(prices, window<span style=color:#f92672>=</span>graph_window)
</span></span><span style=display:flex><span>gf_weekly <span style=color:#f92672>=</span> (gf_daily
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span>resample(<span style=color:#e6db74>&#39;W-FRI&#39;</span>)<span style=color:#f92672>.</span>last()
</span></span><span style=display:flex><span>                <span style=color:#f92672>.</span>reindex(weekly_ret<span style=color:#f92672>.</span>index, method<span style=color:#f92672>=</span><span style=color:#e6db74>&#39;ffill&#39;</span>))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># (b) compute threshold flags</span>
</span></span><span style=display:flex><span>alpha <span style=color:#f92672>=</span> <span style=color:#ae81ff>2.0</span> <span style=color:#f92672>/</span> (warn_lookback_weeks <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>mu_diam <span style=color:#f92672>=</span> gf_weekly[<span style=color:#e6db74>&#39;diameter&#39;</span>]<span style=color:#f92672>.</span>ewm(alpha<span style=color:#f92672>=</span>alpha, min_periods<span style=color:#f92672>=</span>warn_lookback_weeks<span style=color:#f92672>//</span><span style=color:#ae81ff>2</span>)<span style=color:#f92672>.</span>mean()
</span></span><span style=display:flex><span>sd_diam <span style=color:#f92672>=</span> gf_weekly[<span style=color:#e6db74>&#39;diameter&#39;</span>]<span style=color:#f92672>.</span>ewm(alpha<span style=color:#f92672>=</span>alpha, min_periods<span style=color:#f92672>=</span>warn_lookback_weeks<span style=color:#f92672>//</span><span style=color:#ae81ff>2</span>)<span style=color:#f92672>.</span>std()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mu_betw <span style=color:#f92672>=</span> gf_weekly[<span style=color:#e6db74>&#39;betw_var&#39;</span>]<span style=color:#f92672>.</span>ewm(alpha<span style=color:#f92672>=</span>alpha, min_periods<span style=color:#f92672>=</span>warn_lookback_weeks<span style=color:#f92672>//</span><span style=color:#ae81ff>2</span>)<span style=color:#f92672>.</span>mean()
</span></span><span style=display:flex><span>sd_betw <span style=color:#f92672>=</span> gf_weekly[<span style=color:#e6db74>&#39;betw_var&#39;</span>]<span style=color:#f92672>.</span>ewm(alpha<span style=color:#f92672>=</span>alpha, min_periods<span style=color:#f92672>=</span>warn_lookback_weeks<span style=color:#f92672>//</span><span style=color:#ae81ff>2</span>)<span style=color:#f92672>.</span>std()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>z_diam <span style=color:#f92672>=</span> (gf_weekly[<span style=color:#e6db74>&#39;diameter&#39;</span>] <span style=color:#f92672>-</span> mu_diam) <span style=color:#f92672>/</span> sd_diam
</span></span><span style=display:flex><span>z_betw <span style=color:#f92672>=</span> (gf_weekly[<span style=color:#e6db74>&#39;betw_var&#39;</span>] <span style=color:#f92672>-</span> mu_betw) <span style=color:#f92672>/</span> sd_betw
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>z_spike <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>concat([z_diam, z_betw], axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)<span style=color:#f92672>.</span>clip(lower<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>)<span style=color:#f92672>.</span>max(axis<span style=color:#f92672>=</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># assume z_spike is a pd.Series of your max‐z scores</span>
</span></span><span style=display:flex><span>z_th   <span style=color:#f92672>=</span> <span style=color:#ae81ff>1.645</span>
</span></span><span style=display:flex><span>z_max  <span style=color:#f92672>=</span> <span style=color:#ae81ff>2.576</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e># piecewise linear</span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  a) between z_th and z_max, linearly ramp down</span>
</span></span><span style=display:flex><span>ramp <span style=color:#f92672>=</span> <span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> ((z_spike <span style=color:#f92672>-</span> z_th) <span style=color:#f92672>/</span> (z_max <span style=color:#f92672>-</span> z_th)) <span style=color:#f92672>*</span> (<span style=color:#ae81ff>1</span> <span style=color:#f92672>-</span> s_min)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>#  b) combine into one Series</span>
</span></span><span style=display:flex><span>risk_scale <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>Series(<span style=color:#ae81ff>1.0</span>, index<span style=color:#f92672>=</span>z_spike<span style=color:#f92672>.</span>index)
</span></span><span style=display:flex><span><span style=color:#75715e># when above threshold, use ramp but cap at s_min</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>mask <span style=color:#f92672>=</span> z_spike <span style=color:#f92672>&gt;</span> z_th
</span></span><span style=display:flex><span>risk_scale[mask] <span style=color:#f92672>=</span> ramp[mask]<span style=color:#f92672>.</span>clip(lower<span style=color:#f92672>=</span>s_min)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>position_warn   <span style=color:#f92672>=</span> signal <span style=color:#f92672>*</span> pos_size <span style=color:#f92672>*</span> risk_scale
</span></span><span style=display:flex><span>trade_cost_warn <span style=color:#f92672>=</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>*</span> commission <span style=color:#f92672>*</span> pd<span style=color:#f92672>.</span>Series(position_warn)<span style=color:#f92672>.</span>diff()<span style=color:#f92672>.</span>abs()<span style=color:#f92672>.</span>shift(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>strat_ret_warn  <span style=color:#f92672>=</span> position_warn <span style=color:#f92672>*</span> weekly_ret<span style=color:#f92672>.</span>shift(<span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>) <span style=color:#f92672>-</span> trade_cost_warn
</span></span></code></pre></td></tr></table></div></div><p>Kết quả thu được như sau cho cổ phiếu HPG</p><p><img loading=lazy src=images/8.png alt=image.png></p><table><thead><tr><th style=text-align:left>Metric</th><th style=text-align:left>Buy & Hold</th><th style=text-align:left>TSMOM Traditional</th><th style=text-align:left>TSMOM + Graph Warning</th></tr></thead><tbody><tr><td style=text-align:left><strong>Total Return</strong></td><td style=text-align:left>656.45%</td><td style=text-align:left>852.83%</td><td style=text-align:left>1000.08%</td></tr><tr><td style=text-align:left><strong>Annualized Return</strong></td><td style=text-align:left>24.51%</td><td style=text-align:left>27.66%</td><td style=text-align:left>29.66%</td></tr><tr><td style=text-align:left><strong>Annualized Volatility</strong></td><td style=text-align:left>33.91%</td><td style=text-align:left>29.95%</td><td style=text-align:left>29.14%</td></tr><tr><td style=text-align:left><strong>Sharpe Ratio</strong></td><td style=text-align:left>0.82</td><td style=text-align:left>0.97</td><td style=text-align:left>1.04</td></tr><tr><td style=text-align:left><strong>Sortino Ratio</strong></td><td style=text-align:left>1.28</td><td style=text-align:left>1.56</td><td style=text-align:left>1.74</td></tr><tr><td style=text-align:left><strong>Max Drawdown</strong></td><td style=text-align:left>–71.62%</td><td style=text-align:left>–41.70%</td><td style=text-align:left>–41.70%</td></tr><tr><td style=text-align:left><strong>95% VaR</strong></td><td style=text-align:left>–6.59%</td><td style=text-align:left>–5.31%</td><td style=text-align:left>–5.24%</td></tr></tbody></table><p>Kết quả cho cổ phiếu HPG cho thấy:</p><p>So với TSMOM truyền thống, việc thêm hệ số cảnh báo đồ thị giúp tăng lợi nhuận trung bình thêm 2% (từ 27.66% lên 29.66%) trong khi giảm nhẹ độ biến động (từ 29.95% xuống 29.14%) từ đó Sharpe Ratio được đẩy lên từ 0.97 lên 1.04. Một mức tối ưu ổn 🙂 tuy nhiên không phải là xuất sắc khi max drawdown vẫn giữ nguyên. Điều này có thể đến từ việc sử dụng dữ liệu hoặc thiết kế của công cụ quản trị rủi ro chưa bắt được đúng những pha giảm mạnh của thị trường. Việc tối ưu hoặc xây dựng một cơ chế đo lường rủi ro khác có thể được dễ dàng thực hiện cho bạn đọc.</p><p><img loading=lazy src=images/9.png alt=image.png></p><p>Tuy nhiên, việc tách bạch cơ chế giữa chiến lược mua/bán cổ phiếu với cơ chế quản trị rủi ro có thể giúp trader dễ dàng cân chỉnh được phần hiệu suất của chiến lược hay cơ chế quản trị rủi ro từ đó giúp cho hệ thống minh bạch, dễ kiểm soát và đáng tin hơn.</p><h2 id=kết-luận>Kết luận<a hidden class=anchor aria-hidden=true href=#kết-luận>#</a></h2><p>Visibility Graph mở ra một lăng kính mới trong phân tích chuỗi thời gian tài chính, giúp chuyển hóa những quy luật ẩn sâu trong chuyển động giá thành cấu trúc mạng có thể khai thác bằng các công cụ của network science. Thay vì chỉ dựa vào giả định tuyến tính và tính dừng của mô hình thống kê truyền thống, phương pháp này tận dụng được các phụ thuộc phi tuyến và khả năng nhận diện các “regime” thị trường thông qua phân cộng đồng. Việc áp dụng Natural Visibility Graph cùng thuật toán Louvain không chỉ cho phép phát hiện trực quan các giai đoạn của giá cổ phiếu nói riêng và time series nói chung mà còn cung cấp nền tảng để xây dựng các chỉ báo quản trị rủi ro dựa trên cấu trúc mạng.</p><p>Ngoài ra, phương pháp này cũng là một cách tiếp cận đầy tiềm năng trong việc xây dựng các công cụ quản trị rủi ro thông qua khai thác thêm các đặc trưng mạng để xác định các giai đoạn stress của thị trường, rủi ro phân mảnh của cổ phiếu hay chuyển đổi regime để từ đó tích hợp vào trong từng chiến lược đầu tư.</p><p>Tóm lại, visibility graph không chỉ là công cụ hỗ trợ phân tích chuỗi thời gian mà còn là nền tảng để xây dựng các chỉ báo rủi ro mang tính cấu trúc và động lực. Việc tiếp tục khai thác các đặc trưng mạng chuyên sâu và tinh chỉnh cơ chế kích hoạt sẽ giúp hoàn thiện mô hình, đồng thời đem lại lợi thế cạnh tranh trong quản trị rủi ro và tối ưu hóa chiến lược đầu tư.</p><h2 id=reference>Reference<a hidden class=anchor aria-hidden=true href=#reference>#</a></h2><p>[1] <a href=https://cbergillos.com/ts2vg/examples.html>https://cbergillos.com/ts2vg/examples.html</a></p><p>[2] <a href=https://www.cs.cornell.edu/home/kleinber/networks-book/>https://www.cs.cornell.edu/home/kleinber/networks-book/</a></p><p>[3] <a href=https://onlinelibrary.wiley.com/doi/epdf/10.1155/2019/5320686>https://onlinelibrary.wiley.com/doi/epdf/10.1155/2019/5320686</a></p><p>[4] <a href=https://vnquant.vn/posts/2025/2025-05-17-stock-market-network/>https://vnquant.vn/posts/2025/2025-05-17-stock-market-network/</a></p><p>[5] <a href=https://vnquant.vn/posts/2025/2025-03-24-tsmom-vietnam/>https://vnquant.vn/posts/2025/2025-03-24-tsmom-vietnam/</a></p><p>[6] <a href=https://arxiv.org/abs/0810.0920>https://arxiv.org/abs/0810.0920</a></p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=http://localhost:1313/posts/2025/2025-05-17-stock-market-network/><span class=title>Bài cũ hơn »</span><br><span>Community detection for VN100</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Graph visibility for regime detection and risk management on x" href="https://x.com/intent/tweet/?text=Graph%20visibility%20for%20regime%20detection%20and%20risk%20management&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-06-23-graph-visibility-regime-and-risk-management%2f&amp;hashtags="><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Graph visibility for regime detection and risk management on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-06-23-graph-visibility-regime-and-risk-management%2f&amp;title=Graph%20visibility%20for%20regime%20detection%20and%20risk%20management&amp;summary=Graph%20visibility%20for%20regime%20detection%20and%20risk%20management&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-06-23-graph-visibility-regime-and-risk-management%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Graph visibility for regime detection and risk management on reddit" href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-06-23-graph-visibility-regime-and-risk-management%2f&title=Graph%20visibility%20for%20regime%20detection%20and%20risk%20management"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Graph visibility for regime detection and risk management on facebook" href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-06-23-graph-visibility-regime-and-risk-management%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Graph visibility for regime detection and risk management on whatsapp" href="https://api.whatsapp.com/send?text=Graph%20visibility%20for%20regime%20detection%20and%20risk%20management%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-06-23-graph-visibility-regime-and-risk-management%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Graph visibility for regime detection and risk management on telegram" href="https://telegram.me/share/url?text=Graph%20visibility%20for%20regime%20detection%20and%20risk%20management&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-06-23-graph-visibility-regime-and-risk-management%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Graph visibility for regime detection and risk management on ycombinator" href="https://news.ycombinator.com/submitlink?t=Graph%20visibility%20for%20regime%20detection%20and%20risk%20management&u=http%3a%2f%2flocalhost%3a1313%2fposts%2f2025%2f2025-06-23-graph-visibility-regime-and-risk-management%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=http://localhost:1313/>The Financial Engineer</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="Sao chép";function s(){t.innerHTML="Đã sao chép!",setTimeout(()=>{t.innerHTML="Sao chép"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>